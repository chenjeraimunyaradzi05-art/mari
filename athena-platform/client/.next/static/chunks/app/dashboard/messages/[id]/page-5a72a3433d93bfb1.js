(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1695],{670:function(e,t,a){Promise.resolve().then(a.bind(a,39846))},32489:function(e,t,a){"use strict";a.d(t,{Z:function(){return r}});let r=(0,a(39763).Z)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},39846:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return g}});var r=a(57437),s=a(2265),n=a(72967),l=a(92371),d=a(52519),i=a(84122),c=a(53113),o=a(32489),u=a(76980),x=a(12381),m=a(40279);function f(e){let{conversationId:t}=e,{data:a,isLoading:f}=(0,n.y_)(t),g=(0,n.$3)(),{user:h}=(0,l.tN)(),{messages:p,setMessages:y,addMessage:b,setActiveConversation:v,markConversationAsRead:j}=(0,d.a)(),[N,w]=(0,s.useState)(""),[k,I]=(0,s.useState)([]),A=(0,s.useRef)(null),S=(0,s.useRef)(null),_=p[t]||[],C=()=>{var e;null===(e=A.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,s.useEffect)(()=>{C()},[_]),(0,s.useEffect)(()=>(v(t),j(t),()=>v(null)),[t,j,v]),(0,s.useEffect)(()=>{a&&y(t,a.map(e=>({id:e.id,senderId:e.senderId,content:e.content,createdAt:e.createdAt,type:"text",status:"read"})))},[a,t,y]);let E=async e=>{if(e.preventDefault(),N.trim()||0!==k.length)try{let e=await g.mutateAsync({receiverId:t,content:N});if(w(""),I([]),e){var a;b(t,{id:(null===(a=e.data)||void 0===a?void 0:a.id)||crypto.randomUUID(),senderId:(null==h?void 0:h.id)||"",content:N,createdAt:new Date().toISOString(),type:"text",status:"sent"})}}catch(e){console.error("Failed to send message",e)}},Z=e=>{e&&I(t=>[...t,...Array.from(e)])},D=e=>{I(t=>t.filter((t,a)=>a!==e))};return f&&0===_.length?(0,r.jsx)("div",{className:"flex-1 flex items-center justify-center h-full",children:"Loading messages..."}):(0,r.jsxs)("div",{className:"flex flex-col h-full bg-gray-50 dark:bg-gray-950",children:[(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[_.map(e=>{let t=e.senderId===(null==h?void 0:h.id);return(0,r.jsx)("div",{className:"flex ".concat(t?"justify-end":"justify-start"),children:(0,r.jsxs)("div",{className:"max-w-[70%] px-4 py-2 rounded-lg shadow-sm ".concat(t?"bg-blue-600 text-white rounded-br-none":"bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 rounded-bl-none"),children:[(0,r.jsx)("p",{className:"whitespace-pre-wrap break-words text-sm",children:e.content}),(0,r.jsxs)("div",{className:"text-xs mt-1 flex items-center gap-2 ".concat(t?"text-blue-100":"text-gray-400"),children:[(0,r.jsx)("span",{children:(0,i.WU)(new Date(e.createdAt),"h:mm a")}),t&&e.status&&(0,r.jsx)("span",{className:"uppercase tracking-wide",children:"sending"===e.status?"Sending":e.status})]})]})},e.id)}),(0,r.jsx)("div",{ref:A})]}),(0,r.jsxs)("div",{className:"bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-800 p-4",children:[k.length>0&&(0,r.jsx)("div",{className:"mb-3 grid grid-cols-2 md:grid-cols-4 gap-2",children:k.map((e,t)=>(0,r.jsxs)("div",{className:"relative border border-gray-200 dark:border-gray-700 rounded-lg p-2 text-xs text-gray-600 dark:text-gray-300",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(c.Z,{className:"w-4 h-4 text-gray-400"}),(0,r.jsx)("span",{className:"truncate",children:e.name})]}),(0,r.jsx)("button",{type:"button",onClick:()=>D(t),className:"absolute -top-2 -right-2 bg-gray-900 text-white rounded-full w-5 h-5 flex items-center justify-center","aria-label":"Remove attachment",children:(0,r.jsx)(o.Z,{className:"w-3 h-3"})})]},"".concat(e.name,"-").concat(t)))}),(0,r.jsxs)("form",{onSubmit:E,className:"flex gap-2 items-center",children:[(0,r.jsx)("input",{ref:S,type:"file",multiple:!0,className:"hidden",onChange:e=>Z(e.target.files)}),(0,r.jsx)(x.z,{type:"button",variant:"outline",size:"icon","aria-label":"Attach files",onClick:()=>{var e;return null===(e=S.current)||void 0===e?void 0:e.click()},children:(0,r.jsx)(u.Z,{className:"w-4 h-4"})}),(0,r.jsx)("div",{className:"flex-1",children:(0,r.jsx)(m.I,{value:N,onChange:e=>w(e.target.value),placeholder:"Type a message...","aria-label":"Message"})}),(0,r.jsx)(x.z,{type:"submit",disabled:!N.trim()&&0===k.length||g.isPending,children:"Send"})]})]})]})}function g(e){let{params:t}=e;return(0,r.jsx)(f,{conversationId:t.id})}},40279:function(e,t,a){"use strict";a.d(t,{I:function(){return l}});var r=a(57437),s=a(2265),n=a(93448);let l=s.forwardRef((e,t)=>{let{className:a,type:s,error:l,label:d,icon:i,...c}=e;return(0,r.jsxs)("div",{className:"w-full",children:[d&&(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:d}),(0,r.jsxs)("div",{className:"relative",children:[i&&(0,r.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:i}),(0,r.jsx)("input",{type:s,className:(0,n.cn)("flex h-10 w-full rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-800 px-3 py-2 text-sm text-gray-900 dark:text-white placeholder:text-gray-400 dark:placeholder:text-gray-500 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent disabled:cursor-not-allowed disabled:opacity-50",i&&"pl-10",l&&"border-red-500 focus:ring-red-500",a),ref:t,...c})]}),l&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:l})]})});l.displayName="Input"}},function(e){e.O(0,[3464,6137,5021,1713,9064,5883,2020,4122,1837,2967,2538,2971,2117,1744],function(){return e(e.s=670)}),_N_E=e.O()}]);