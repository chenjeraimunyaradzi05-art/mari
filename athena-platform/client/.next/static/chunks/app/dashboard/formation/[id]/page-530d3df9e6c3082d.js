(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1739],{72498:function(e,t,s){Promise.resolve().then(s.bind(s,62575))},27648:function(e,t,s){"use strict";s.d(t,{default:function(){return a.a}});var i=s(72972),a=s.n(i)},99376:function(e,t,s){"use strict";var i=s(35475);s.o(i,"useParams")&&s.d(t,{useParams:function(){return i.useParams}}),s.o(i,"usePathname")&&s.d(t,{usePathname:function(){return i.usePathname}}),s.o(i,"useRouter")&&s.d(t,{useRouter:function(){return i.useRouter}}),s.o(i,"useSearchParams")&&s.d(t,{useSearchParams:function(){return i.useSearchParams}})},62575:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return u}});var i=s(57437),a=s(2265),r=s(27648),n=s(99376),o=s(72967),l=s(93448);function d(e){return e&&"object"==typeof e&&!Array.isArray(e)?e:{}}function u(){var e;let t=(0,n.useParams)(),s=(null==t?void 0:t.id)||"",{data:u,isLoading:c}=(0,o.dl)(s),h=(0,o.zJ)(),m=(0,o.mz)(),p=(0,a.useMemo)(()=>{var e;return(null==u?void 0:u.businessName)||(null==u?void 0:null===(e=u.data)||void 0===e?void 0:e.businessName)||""},[u]),x=(0,a.useMemo)(()=>{let e=d(null==u?void 0:u.data),t=e.directors,s=(Array.isArray(t)?t:[]).map(e=>{if("string"==typeof e)return e;let t=d(e);return"string"==typeof t.name?t.name:""}).map(e=>e.trim()).filter(Boolean).join("\n"),i=(d(e.registeredAddress).line1||d(e.businessAddress).line1||d(e.principalPlaceOfBusiness).line1||d(e.address).line1,d(e.registeredAddress)),a=d(i);return{directorsText:s,addressLine1:"string"==typeof a.line1?a.line1:"",addressCity:"string"==typeof a.city?a.city:"",addressState:"string"==typeof a.state?a.state:"",addressPostcode:"string"==typeof a.postcode?a.postcode:"",addressCountry:"string"==typeof a.country?a.country:""}},[u]),f=(0,a.useMemo)(()=>{let e=d(null==u?void 0:u.data).partners;return{partnersText:(Array.isArray(e)?e:[]).map(e=>{if("string"==typeof e)return e;let t=d(e);return"string"==typeof t.name?t.name:""}).map(e=>e.trim()).filter(Boolean).join("\n")}},[u]),y=(0,a.useMemo)(()=>{let e=d(null==u?void 0:u.data).trustees;return{trusteesText:(Array.isArray(e)?e:[]).map(e=>{if("string"==typeof e)return e;let t=d(e);return"string"==typeof t.name?t.name:""}).map(e=>e.trim()).filter(Boolean).join("\n")}},[u]),[b,g]=(0,a.useState)(""),[v,N]=(0,a.useState)(""),[j,P]=(0,a.useState)(""),[C,S]=(0,a.useState)(""),[R,w]=(0,a.useState)(""),[A,M]=(0,a.useState)(""),[O,T]=(0,a.useState)(""),[E,k]=(0,a.useState)(""),[B,D]=(0,a.useState)("");(0,a.useEffect)(()=>{g(p)},[p]),(0,a.useEffect)(()=>{N(x.directorsText),P(x.addressLine1),S(x.addressCity),w(x.addressState),M(x.addressPostcode),T(x.addressCountry)},[x]),(0,a.useEffect)(()=>{k(f.partnersText)},[f]),(0,a.useEffect)(()=>{D(y.trusteesText)},[y]);let K=(null==u?void 0:u.status)==="DRAFT"||(null==u?void 0:u.status)==="NEEDS_INFO",L=(0,a.useMemo)(()=>{let e=(null==u?void 0:u.type)==="COMPANY",t=(null==u?void 0:u.type)==="PARTNERSHIP",s=(null==u?void 0:u.type)==="TRUST",i=(null==u?void 0:u.type)==="SOLE_TRADER",a=b.trim().length>0,r=v.split(/\r?\n/).map(e=>e.trim()).filter(Boolean).length,n=E.split(/\r?\n/).map(e=>e.trim()).filter(Boolean).length,o=B.split(/\r?\n/).map(e=>e.trim()).filter(Boolean).length,l=j.trim().length>0||C.trim().length>0||R.trim().length>0||A.trim().length>0||O.trim().length>0,d=[];a||d.push("Business name"),e&&(0===r&&d.push("At least 1 director"),l||d.push("Registered address")),t&&0===n&&d.push("At least 1 partner"),s&&0===o&&d.push("At least 1 trustee");let c=[];i&&c.push("Sole Trader: currently only business name is required for submission."),K||c.push("This registration is not editable in its current status.");let h=[{label:"Business name",ok:a}];return e&&(h.push({label:"At least 1 director",ok:r>0}),h.push({label:"Registered address",ok:l})),t&&h.push({label:"At least 1 partner",ok:n>0}),s&&h.push({label:"At least 1 trustee",ok:o>0}),{checks:h,missing:d,notes:c,isCompany:e,isPartnership:t,isTrust:s,isSoleTrader:i}},[null==u?void 0:u.type,K,b,v,E,B,j,C,R,A,O]),U=async()=>{let e=d(null==u?void 0:u.data),t=(null==u?void 0:u.type)==="COMPANY",i=(null==u?void 0:u.type)==="PARTNERSHIP",a=(null==u?void 0:u.type)==="TRUST",r=v.split(/\r?\n/).map(e=>e.trim()).filter(Boolean),n=E.split(/\r?\n/).map(e=>e.trim()).filter(Boolean),o=B.split(/\r?\n/).map(e=>e.trim()).filter(Boolean),l={line1:j.trim(),city:C.trim(),state:R.trim(),postcode:A.trim(),country:O.trim()};await m.mutateAsync({id:s,data:{...e,businessName:b,...t?{directors:r,registeredAddress:l}:null,...i?{partners:n}:null,...a?{trustees:o}:null}})},F=async()=>{K&&await U(),await h.mutateAsync(s)};return c?(0,i.jsx)("div",{className:"py-8 text-sm text-muted-foreground",children:"Loading…"}):u?(0,i.jsxs)("div",{className:"max-w-3xl space-y-6 py-8",children:[(0,i.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,i.jsxs)("div",{className:"space-y-1",children:[(0,i.jsx)(r.default,{href:"/dashboard/formation",className:"text-sm text-primary hover:underline",children:"← Back"}),(0,i.jsx)("h1",{className:"text-2xl font-bold",children:u.businessName||"Untitled registration"}),(0,i.jsxs)("p",{className:"text-sm text-muted-foreground",children:[u.type," • Status: ",u.status,u.updatedAt?" • Updated ".concat((0,l.SY)(u.updatedAt)):""]})]}),(0,i.jsx)("span",{className:"text-xs px-2 py-1 rounded bg-muted text-muted-foreground",children:u.status})]}),(0,i.jsxs)("div",{className:"border rounded-lg p-6 space-y-4",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold",children:"Business name"}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("label",{className:"text-sm font-medium",children:"Name"}),(0,i.jsx)("input",{type:"text",value:b,onChange:e=>g(e.target.value),disabled:!K||m.isPending,className:"w-full p-2 border rounded-md disabled:opacity-50",placeholder:"e.g. Athena Consulting"})]}),(0,i.jsxs)("div",{className:"flex gap-2",children:[(0,i.jsx)("button",{type:"button",onClick:U,disabled:!K||m.isPending,className:"px-4 py-2 bg-primary text-white rounded-md hover:bg-primary/90 disabled:opacity-50",children:m.isPending?"Saving…":"Save"}),(0,i.jsx)("button",{type:"button",onClick:F,disabled:!K||h.isPending||m.isPending,className:"px-4 py-2 border rounded-md hover:bg-gray-50 disabled:opacity-50",children:h.isPending?"Submitting…":"Submit"})]}),!K&&(0,i.jsx)("p",{className:"text-xs text-muted-foreground",children:"This registration can’t be submitted in its current status."})]}),(0,i.jsxs)("div",{className:"border rounded-lg p-6 space-y-3",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold",children:"Observations"}),L.notes.length>0&&(0,i.jsx)("div",{className:"text-sm text-muted-foreground space-y-1",children:L.notes.map(e=>(0,i.jsx)("div",{children:e},e))}),(0,i.jsx)("div",{className:"grid gap-2",children:L.checks.map(e=>(0,i.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,i.jsx)("span",{className:"text-sm",children:e.label}),(0,i.jsx)("span",{className:"text-sm",children:e.ok?"✓":"—"})]},e.label))}),0===L.missing.length?(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"Looks ready to submit."}):(0,i.jsxs)("p",{className:"text-sm text-muted-foreground",children:["Likely to fail submission until fixed: ",L.missing.join(", "),"."]})]}),"COMPANY"===u.type&&(0,i.jsxs)("div",{className:"border rounded-lg p-6 space-y-4",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold",children:"Company minimum fields"}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"Directors and a registered address are required before submission."}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("label",{className:"text-sm font-medium",children:"Directors (one per line)"}),(0,i.jsx)("textarea",{value:v,onChange:e=>N(e.target.value),disabled:!K||m.isPending,className:"w-full min-h-24 p-2 border rounded-md disabled:opacity-50",placeholder:"Jane Doe\\nAisha Khan"})]}),(0,i.jsxs)("div",{className:"grid gap-3 md:grid-cols-2",children:[(0,i.jsxs)("div",{className:"space-y-2 md:col-span-2",children:[(0,i.jsx)("label",{className:"text-sm font-medium",children:"Address line 1"}),(0,i.jsx)("input",{type:"text",value:j,onChange:e=>P(e.target.value),disabled:!K||m.isPending,className:"w-full p-2 border rounded-md disabled:opacity-50",placeholder:"123 Example St"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("label",{className:"text-sm font-medium",children:"City"}),(0,i.jsx)("input",{type:"text",value:C,onChange:e=>S(e.target.value),disabled:!K||m.isPending,className:"w-full p-2 border rounded-md disabled:opacity-50"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("label",{className:"text-sm font-medium",children:"State"}),(0,i.jsx)("input",{type:"text",value:R,onChange:e=>w(e.target.value),disabled:!K||m.isPending,className:"w-full p-2 border rounded-md disabled:opacity-50"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("label",{className:"text-sm font-medium",children:"Postcode"}),(0,i.jsx)("input",{type:"text",value:A,onChange:e=>M(e.target.value),disabled:!K||m.isPending,className:"w-full p-2 border rounded-md disabled:opacity-50"})]}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("label",{className:"text-sm font-medium",children:"Country"}),(0,i.jsx)("input",{type:"text",value:O,onChange:e=>T(e.target.value),disabled:!K||m.isPending,className:"w-full p-2 border rounded-md disabled:opacity-50",placeholder:"Australia"})]})]})]}),"PARTNERSHIP"===u.type&&(0,i.jsxs)("div",{className:"border rounded-lg p-6 space-y-4",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold",children:"Partnership minimum fields"}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"Partner details are required before submission."}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("label",{className:"text-sm font-medium",children:"Partners (one per line)"}),(0,i.jsx)("textarea",{value:E,onChange:e=>k(e.target.value),disabled:!K||m.isPending,className:"w-full min-h-24 p-2 border rounded-md disabled:opacity-50",placeholder:"Jane Doe\\nAisha Khan"})]})]}),"TRUST"===u.type&&(0,i.jsxs)("div",{className:"border rounded-lg p-6 space-y-4",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold",children:"Trust minimum fields"}),(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"Trustee details are required before submission."}),(0,i.jsxs)("div",{className:"space-y-2",children:[(0,i.jsx)("label",{className:"text-sm font-medium",children:"Trustees (one per line)"}),(0,i.jsx)("textarea",{value:B,onChange:e=>D(e.target.value),disabled:!K||m.isPending,className:"w-full min-h-24 p-2 border rounded-md disabled:opacity-50",placeholder:"Jane Doe\\nAisha Khan"})]})]}),(0,i.jsxs)("div",{className:"border rounded-lg p-6 space-y-3",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold",children:"Raw data"}),(0,i.jsx)("pre",{className:"text-xs bg-slate-50 border rounded-md p-4 overflow-auto",children:JSON.stringify(null!==(e=u.data)&&void 0!==e?e:{},null,2)})]})]}):(0,i.jsxs)("div",{className:"py-8 space-y-4",children:[(0,i.jsx)("p",{className:"text-sm text-muted-foreground",children:"Registration not found."}),(0,i.jsx)(r.default,{href:"/dashboard/formation",className:"text-sm text-primary hover:underline",children:"Back to Formation Studio"})]})}},2894:function(e,t,s){"use strict";s.d(t,{R:function(){return o},m:function(){return n}});var i=s(18238),a=s(7989),r=s(11255),n=class extends a.F{#e;#t;#s;#i;constructor(e){super(),this.#e=e.client,this.mutationId=e.mutationId,this.#s=e.mutationCache,this.#t=[],this.state=e.state||o(),this.setOptions(e.options),this.scheduleGc()}setOptions(e){this.options=e,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(e){this.#t.includes(e)||(this.#t.push(e),this.clearGcTimeout(),this.#s.notify({type:"observerAdded",mutation:this,observer:e}))}removeObserver(e){this.#t=this.#t.filter(t=>t!==e),this.scheduleGc(),this.#s.notify({type:"observerRemoved",mutation:this,observer:e})}optionalRemove(){this.#t.length||("pending"===this.state.status?this.scheduleGc():this.#s.remove(this))}continue(){return this.#i?.continue()??this.execute(this.state.variables)}async execute(e){let t=()=>{this.#a({type:"continue"})},s={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#i=(0,r.Mz)({fn:()=>this.options.mutationFn?this.options.mutationFn(e,s):Promise.reject(Error("No mutationFn found")),onFail:(e,t)=>{this.#a({type:"failed",failureCount:e,error:t})},onPause:()=>{this.#a({type:"pause"})},onContinue:t,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#s.canRun(this)});let i="pending"===this.state.status,a=!this.#i.canStart();try{if(i)t();else{this.#a({type:"pending",variables:e,isPaused:a}),await this.#s.config.onMutate?.(e,this,s);let t=await this.options.onMutate?.(e,s);t!==this.state.context&&this.#a({type:"pending",context:t,variables:e,isPaused:a})}let r=await this.#i.start();return await this.#s.config.onSuccess?.(r,e,this.state.context,this,s),await this.options.onSuccess?.(r,e,this.state.context,s),await this.#s.config.onSettled?.(r,null,this.state.variables,this.state.context,this,s),await this.options.onSettled?.(r,null,e,this.state.context,s),this.#a({type:"success",data:r}),r}catch(t){try{await this.#s.config.onError?.(t,e,this.state.context,this,s)}catch(e){Promise.reject(e)}try{await this.options.onError?.(t,e,this.state.context,s)}catch(e){Promise.reject(e)}try{await this.#s.config.onSettled?.(void 0,t,this.state.variables,this.state.context,this,s)}catch(e){Promise.reject(e)}try{await this.options.onSettled?.(void 0,t,e,this.state.context,s)}catch(e){Promise.reject(e)}throw this.#a({type:"error",error:t}),t}finally{this.#s.runNext(this)}}#a(e){this.state=(t=>{switch(e.type){case"failed":return{...t,failureCount:e.failureCount,failureReason:e.error};case"pause":return{...t,isPaused:!0};case"continue":return{...t,isPaused:!1};case"pending":return{...t,context:e.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:e.isPaused,status:"pending",variables:e.variables,submittedAt:Date.now()};case"success":return{...t,data:e.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...t,data:void 0,error:e.error,failureCount:t.failureCount+1,failureReason:e.error,isPaused:!1,status:"error"}}})(this.state),i.Vr.batch(()=>{this.#t.forEach(t=>{t.onMutationUpdate(e)}),this.#s.notify({mutation:this,type:"updated",action:e})})}};function o(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}},21770:function(e,t,s){"use strict";s.d(t,{D:function(){return u}});var i=s(2265),a=s(2894),r=s(18238),n=s(24112),o=s(45345),l=class extends n.l{#e;#r=void 0;#n;#o;constructor(e,t){super(),this.#e=e,this.setOptions(t),this.bindMethods(),this.#l()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){let t=this.options;this.options=this.#e.defaultMutationOptions(e),(0,o.VS)(this.options,t)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),t?.mutationKey&&this.options.mutationKey&&(0,o.Ym)(t.mutationKey)!==(0,o.Ym)(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(e){this.#l(),this.#d(e)}getCurrentResult(){return this.#r}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#l(),this.#d()}mutate(e,t){return this.#o=t,this.#n?.removeObserver(this),this.#n=this.#e.getMutationCache().build(this.#e,this.options),this.#n.addObserver(this),this.#n.execute(e)}#l(){let e=this.#n?.state??(0,a.R)();this.#r={...e,isPending:"pending"===e.status,isSuccess:"success"===e.status,isError:"error"===e.status,isIdle:"idle"===e.status,mutate:this.mutate,reset:this.reset}}#d(e){r.Vr.batch(()=>{if(this.#o&&this.hasListeners()){let t=this.#r.variables,s=this.#r.context,i={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};if(e?.type==="success"){try{this.#o.onSuccess?.(e.data,t,s,i)}catch(e){Promise.reject(e)}try{this.#o.onSettled?.(e.data,null,t,s,i)}catch(e){Promise.reject(e)}}else if(e?.type==="error"){try{this.#o.onError?.(e.error,t,s,i)}catch(e){Promise.reject(e)}try{this.#o.onSettled?.(void 0,e.error,t,s,i)}catch(e){Promise.reject(e)}}}this.listeners.forEach(e=>{e(this.#r)})})}},d=s(29827);function u(e,t){let s=(0,d.NL)(t),[a]=i.useState(()=>new l(s,e));i.useEffect(()=>{a.setOptions(e)},[a,e]);let n=i.useSyncExternalStore(i.useCallback(e=>a.subscribe(r.Vr.batchCalls(e)),[a]),()=>a.getCurrentResult(),()=>a.getCurrentResult()),u=i.useCallback((e,t)=>{a.mutate(e,t).catch(o.ZT)},[a]);if(n.error&&(0,o.L3)(a.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:u,mutateAsync:n.mutate}}}},function(e){e.O(0,[2972,3464,6137,5021,1713,9064,5883,1837,2967,2971,2117,1744],function(){return e(e.s=72498)}),_N_E=e.O()}]);