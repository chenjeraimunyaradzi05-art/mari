// ===========================================
// ATHENA PRISMA DATABASE SCHEMA
// Version: 1.0
// ===========================================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===========================================
// ENUMS
// ===========================================

enum UserRole {
  USER
  CREATOR
  MENTOR
  EMPLOYER
  EDUCATION_PROVIDER
  ADMIN
}

enum Persona {
  EARLY_CAREER        // 25-35, entry level
  MID_CAREER          // 35-50, experienced
  ENTREPRENEUR        // Business owners
  CREATOR             // Content creators
  MENTOR              // Career coaches
  EDUCATION_PROVIDER  // Unis, TAFEs
  EMPLOYER            // HR/Recruiters
  REAL_ESTATE         // Property professionals
  GOVERNMENT_NGO      // Social services
}

enum Region {
  ANZ
  US
  SEA
  MEA
  UK
  EU
  ROW
}

enum SubscriptionTier {
  FREE
  PREMIUM_CAREER       // $9.99/mo
  PREMIUM_PROFESSIONAL // $24.99/mo
  PREMIUM_ENTREPRENEUR // $19.99/mo
  PREMIUM_CREATOR      // $99/mo
  ENTERPRISE           // Custom pricing
}

enum SubscriptionStatus {
  ACTIVE
  CANCELED
  PAST_DUE
  TRIALING
}

enum JobType {
  FULL_TIME
  PART_TIME
  CONTRACT
  CASUAL
  INTERNSHIP
  APPRENTICESHIP
}

enum JobStatus {
  DRAFT
  ACTIVE
  PAUSED
  CLOSED
  EXPIRED
}

enum ApplicationStatus {
  PENDING
  REVIEWED
  SHORTLISTED
  INTERVIEW
  OFFERED
  REJECTED
  WITHDRAWN
}

enum PostType {
  TEXT
  IMAGE
  VIDEO
  ARTICLE
  JOB_SHARE
  COURSE_SHARE
}

enum StatusType {
  IMAGE
  VIDEO
}

enum GroupPrivacy {
  PUBLIC
  PRIVATE
}

enum GroupRole {
  ADMIN
  MODERATOR
  MEMBER
}

enum GroupJoinRequestStatus {
  PENDING
  APPROVED
  DENIED
}

enum EventType {
  WEBINAR
  WORKSHOP
  NETWORKING
  CONFERENCE
  MEETUP
}

enum EventFormat {
  VIRTUAL
  IN_PERSON
  HYBRID
}

enum NotificationType {
  LIKE
  COMMENT
  FOLLOW
  MENTION
  JOB_MATCH
  APPLICATION_UPDATE
  MESSAGE
  SYSTEM
  ACHIEVEMENT
  LEVEL_UP
  MENTOR_SESSION
  GIFT_RECEIVED
}

enum MentorSessionStatus {
  REQUESTED
  CONFIRMED
  CANCELED
  COMPLETED
}

enum ReferralStatus {
  PENDING
  COMPLETED
  EXPIRED
}

enum AuditAction {
  DSAR_EXPORT
  DATA_ACCESS
  ACCOUNT_DELETE
  ADMIN_USER_UPDATE
  ADMIN_USER_DELETE
  ADMIN_POST_HIDE
  ADMIN_POST_UNHIDE
  ADMIN_POST_DELETE
  ADMIN_POST_CLEAR_REPORTS
  ADMIN_COMMENT_DELETE
  ADMIN_GROUP_CREATE
  ADMIN_GROUP_UPDATE
  ADMIN_GROUP_DELETE
  ADMIN_GROUP_MEMBER_ROLE_UPDATE
  ADMIN_GROUP_POST_DELETE
  ADMIN_EVENT_CREATE
  ADMIN_EVENT_UPDATE
  ADMIN_EVENT_DELETE
  ADMIN_JOB_UPDATE
  ADMIN_SUBSCRIPTION_UPDATE
  ADMIN_SUBSCRIPTION_GRANT
  ADMIN_VERIFICATION_APPROVE
  ADMIN_VERIFICATION_REJECT
  ADMIN_APPEAL_DECISION
  USER_VERIFICATION_SUBMIT
  USER_APPEAL_SUBMIT
}

enum VerificationBadgeType {
  IDENTITY
  EMPLOYER
  EDUCATOR
  MENTOR
  CREATOR
}

enum AccountingAccountType {
  ASSET
  LIABILITY
  EQUITY
  REVENUE
  EXPENSE
}

enum JournalEntryStatus {
  DRAFT
  POSTED
  VOID
}

enum TaxRateType {
  GST
  VAT
  SALES_TAX
  WITHHOLDING
}

enum TaxReturnStatus {
  DRAFT
  SUBMITTED
  ACCEPTED
  REJECTED
}

enum InventoryTransactionType {
  PURCHASE
  SALE
  ADJUSTMENT
  TRANSFER
  RETURN
}

enum InventoryValuationMethod {
  FIFO
  LIFO
  AVERAGE
}

enum MoneyTransactionType {
  PAYMENT
  REFUND
  PAYOUT
  TRANSFER
  ADJUSTMENT
}

// ===========================================
// PHASE 9: BUSINESS TRANSFORMATION ENUMS
// ===========================================

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}

enum MentorPaymentStatus {
  PENDING
  AUTHORIZED
  CAPTURED
  REFUNDED
  FAILED
  CANCELED
}

enum AcceleratorCohortStatus {
  UPCOMING
  ENROLLING
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

enum AcceleratorEnrollmentStatus {
  PENDING
  ACTIVE
  COMPLETED
  DROPPED
  GRADUATED
}

enum GrantProviderType {
  FEDERAL
  STATE
  PRIVATE_FOUNDATION
  CORPORATE
  INTERNATIONAL
}

enum GrantApplicationStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  SHORTLISTED
  AWARDED
  REJECTED
  WITHDRAWN
}

enum InvestorType {
  ANGEL
  VC
  CORPORATE_VC
  FAMILY_OFFICE
  ACCELERATOR
  GOVERNMENT
}

enum IntroductionStatus {
  REQUESTED
  APPROVED
  INTRODUCED
  MEETING_SCHEDULED
  DECLINED
  EXPIRED
}

enum VendorCategory {
  ACCOUNTING_TAX
  LEGAL
  DESIGN_MARKETING
  TECH_DEVELOPMENT
  HR_COMPLIANCE
  BUSINESS_COACHING
  PHOTOGRAPHY_VIDEO
  COPYWRITING
  VIRTUAL_ASSISTANT
  OTHER
}

enum RfpStatus {
  OPEN
  CLOSED
  AWARDED
  CANCELLED
}

enum RfpResponseStatus {
  SUBMITTED
  SHORTLISTED
  SELECTED
  REJECTED
}

// ===========================================
// PHASE 10: HOUSING & FINANCIAL SECURITY ENUMS
// ===========================================

enum HousingListingType {
  RENTAL
  SHARE
  EMERGENCY
  TRANSITIONAL
}

enum HousingListingStatus {
  ACTIVE
  PENDING
  LEASED
  WITHDRAWN
}

enum HousingInquiryStatus {
  PENDING
  CONTACTED
  VIEWING_SCHEDULED
  APPLICATION_SUBMITTED
  APPROVED
  DECLINED
  WITHDRAWN
}

enum SavingsGoalType {
  EMERGENCY_FUND
  HOME_DEPOSIT
  EDUCATION
  BUSINESS
  TRAVEL
  OTHER
}

enum SavingsGoalStatus {
  ACTIVE
  PAUSED
  COMPLETED
  CANCELLED
}

enum InsuranceType {
  INCOME_PROTECTION
  LIFE
  TPD
  TRAUMA
  HEALTH
}

enum InsuranceApplicationStatus {
  DRAFT
  SUBMITTED
  UNDER_REVIEW
  APPROVED
  DECLINED
  ACTIVE
  LAPSED
}

enum MoneyTransactionStatus {
  PENDING
  COMPLETED
  FAILED
  CANCELED
}

enum VerificationStatus {
  PENDING
  APPROVED
  REJECTED
}

enum AppealType {
  CONTENT_MODERATION
  ACCOUNT_SUSPENSION
  VERIFICATION_DECISION
  OTHER
}

enum AppealStatus {
  PENDING
  UNDER_REVIEW
  APPROVED
  REJECTED
}

enum VideoStatus {
  PROCESSING
  PUBLISHED
  HIDDEN
  REMOVED
}

enum VideoType {
  REEL
  STORY
  TUTORIAL
  CAREER_STORY
  MENTOR_TIP
  LIVE_REPLAY
}

enum ChannelType {
  EMPLOYER_BROADCAST
  MENTOR_BROADCAST
  COMMUNITY_CHANNEL
  EDUCATION_CHANNEL
  CREATOR_CHANNEL
}

enum ApprenticeshipStatus {
  OPEN
  FILLED
  CLOSED
  DRAFT
}

enum ApprenticeshipLevel {
  CERTIFICATE_I
  CERTIFICATE_II
  CERTIFICATE_III
  CERTIFICATE_IV
  DIPLOMA
  ADVANCED_DIPLOMA
}

enum ApprenticeshipApplicationStatus {
  SUBMITTED
  SCREENING
  INTERVIEW
  OFFERED
  ACCEPTED
  REJECTED
  WITHDRAWN
}

enum ServiceCategory {
  PROFESSIONAL
  CREATIVE
  TECHNICAL
  COACHING
  TEACHING
}

enum ServiceStatus {
  ACTIVE
  PAUSED
  ARCHIVED
}

enum BookingStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  DISPUTED
}

// ===========================================
// USER & AUTHENTICATION
// ===========================================

model User {
  id                String    @id @default(uuid())
  email             String    @unique
  passwordHash      String?
  emailVerified     Boolean   @default(false)
  emailVerifiedAt   DateTime?
  
  // Profile
  firstName         String
  lastName          String
  displayName       String?
  avatar            String?
  bio               String?   
  headline          String?   // "Marketing Manager at XYZ"
  
  // Persona & Role
  role              UserRole          @default(USER)
  persona           Persona           @default(EARLY_CAREER)
  
  // Location
  city              String?
  state             String?
  country           String            @default("Australia")

  // Regional Preferences
  preferredLocale   String            @default("en-AU")
  preferredCurrency String            @default("AUD")
  timezone          String            @default("Australia/Sydney")
  region            Region            @default(ANZ)

  // Compliance consents
  consentMarketing      Boolean        @default(false)
  consentDataProcessing Boolean        @default(false)
  consentCookies        Boolean        @default(false)
  consentDoNotSell      Boolean        @default(false)
  consentUpdatedAt      DateTime?
  
  // Professional Info
  currentJobTitle   String?
  currentCompany    String?
  yearsExperience   Int?
  
  // Settings
  isPublic          Boolean           @default(true)
  allowMessages     Boolean           @default(true)
  isSuspended       Boolean           @default(false)
  notificationPreferences Json?
  
  // Timestamps
  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  lastLoginAt       DateTime?
  
  // Relations
  profile           Profile?
  subscription      Subscription?
  skills            UserSkill[]
  education         Education[]
  experience        WorkExperience[]
  posts             Post[]
  statuses          Status[]
  comments          Comment[]
  likes             Like[]
  videos            Video[]
  videoLikes        VideoLike[]
  videoComments     VideoComment[]
  videoSaves        VideoSave[]
  channelsOwned     Channel[]        @relation("ChannelOwner")
  channelMemberships ChannelMember[]
  channelMessages   ChannelMessage[]
  groupsCreated     Group[]           @relation("GroupsCreated")
  groupMemberships  GroupMember[]
  groupPosts        GroupPost[]
  groupJoinRequests GroupJoinRequest[]
  groupJoinRequestsReviewed GroupJoinRequest[] @relation("GroupJoinRequestsReviewed")
  eventRegistrations EventRegistration[]
  eventSaves         EventSave[]
  jobsPosted        Job[]             @relation("PostedJobs")
  applications      JobApplication[]
  savedJobs         SavedJob[]
  sentMessages      Message[]         @relation("SentMessages")
  receivedMessages  Message[]         @relation("ReceivedMessages")
  conversations     ConversationParticipant[]
  followers         Follow[]          @relation("Following")
  following         Follow[]          @relation("Followers")
  notifications     Notification[]
  creatorProfile    CreatorProfile?
  mentorProfile     MentorProfile?
  courseEnrollments CourseEnrollment[]
  educationApplications EducationApplication[]
  apprenticeshipApplications ApprenticeshipApplication[]
  skillServices     SkillService[]
  serviceBookings   ServiceBooking[] @relation("ServiceBookingsClient")
  serviceReviews    ServiceReview[]
  userOutcomes      UserOutcome[]
  mentorSessions    MentorSession[]    @relation("MenteeSessions")
  auditLogsAsActor  AuditLog[]         @relation("AuditLogActorUser")
  auditLogsAsTarget AuditLog[]         @relation("AuditLogTargetUser")
  verificationBadges VerificationBadge[] @relation("VerificationApplicant")
  verificationReviews VerificationBadge[] @relation("VerificationReviewer")
  appeals           Appeal[]           @relation("AppealRequester")
  appealsReviewed   Appeal[]           @relation("AppealReviewer")
  sessions          Session[]
  verificationTokens VerificationToken[]
  
  // Referrals
  referralCode      String?           @unique
  referredBy        Referral?         @relation("ReferredUser")
  referralsMade     Referral[]        @relation("ReferrerUser")
  referralCredits   Int               @default(0)
  
  businessRegistrations BusinessRegistration[]

  // Creator Economy
  giftBalance       Int               @default(0) // Gift points balance
  giftBalancePurchases GiftBalancePurchase[]
  giftsSent         GiftTransaction[] @relation("GiftsSent")
  giftsReceived     GiftTransaction[] @relation("GiftsReceived")
  
  // Gamification
  xp                Int               @default(0)
  isActive          Boolean           @default(true)
  isVerified        Boolean           @default(false)
  trustScore        Int               @default(50)
  safetyScore       Int               @default(50) // 0-100 safety score
  safetyScoreUpdatedAt DateTime?
  trustScoreUpdatedAt DateTime?
  streaks           UserStreak[]
  achievements      UserAchievement[]
  xpTransactions    XpTransaction[]
  
  // Organizations (Enterprise)
  organizationMemberships OrganizationMember[]

  // Finance
  accountingAccounts AccountingAccount[]
  journalEntries     JournalEntry[]
  taxReturns         TaxReturn[]
  inventoryTransactionsCreated InventoryTransaction[] @relation("InventoryTransactionsCreated")
  moneyTransactions  MoneyTransaction[]

  // GDPR / Compliance (Phase 4)
  consentRecords    ConsentRecord[]
  dsarRequests      DSARRequest[]

  // Phase 9: Business Transformation
  acceleratorEnrollments AcceleratorEnrollment[]
  grantApplications      GrantApplication[]
  investorIntroductions  InvestorIntroduction[]
  vendorReviews          VendorReview[]
  rfps                   Rfp[]

  // Phase 10: Housing & Financial Security
  housingInquiries       HousingInquiry[]
  savingsGoals           SavingsGoal[]
  insuranceApplications  InsuranceApplication[]
  superAccounts          SuperannuationAccount[]
  financialHealthScore   FinancialHealthScore?

  // Phase 11: Social Impact & Scale
  programEnrollments     ProgramEnrollment[]
  indigenousMemberships  IndigenousCommunityMember[]
  languageProfile        LanguageProfile?
  internationalCredentials InternationalCredential[]
  bridgingEnrollments    BridgingEnrollment[]
  safetyPlan             SafetyPlan?
  accessibilityProfile   AccessibilityProfile?
  impactMetrics          ImpactMetric[]

  // Phase 12: Super App - AI Algorithms
  careerPredictions      CareerPrediction[]
  opportunityMatches     OpportunityMatch[]
  salaryDataPoints       SalaryDataPoint[]
  salaryAnalyses         SalaryAnalysis[]
  menteeMatches          MentorMatchScore[] @relation("MenteeMatches")
  mentorMatches          MentorMatchScore[] @relation("MentorMatches")
  userTrustScore         UserTrustScore?
  reportsSubmitted       ContentReport[]    @relation("ReportsSubmitted")
  reportsReceived        ContentReport[]    @relation("ReportsReceived")
  creatorAnalytics       CreatorAnalytics?
  feedPreferences        UserFeedPreferences?
  
  // Phase 4: UK/EU Compliance
  safetySettings         UserSafetySettings?
  
  // Push notification tokens
  pushTokens             PushToken[]

  // Stripe Connect (Creator/Mentor payouts)
  stripeConnectAccountId String?
  stripeConnectStatus    String?   // 'PENDING', 'ACTIVE', 'RESTRICTED', 'DISABLED'
  escrowPaymentsAsSeller EscrowPayment[] @relation("EscrowSeller")
  escrowPaymentsAsBuyer  EscrowPayment[] @relation("EscrowBuyer")

  // Invoices
  invoices               Invoice[]
  
  // Payments
  payments               Payment[]
  
  // Reference requests (as candidate)
  referenceRequests      ReferenceRequest[] @relation("CandidateReferences")

  @@index([email])
  @@index([persona])
  @@index([country, state, city])
}

model Profile {
  id                String    @id @default(uuid())
  userId            String    @unique
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Extended Bio
  aboutMe           String?   
  
  // Links
  linkedinUrl       String?
  websiteUrl        String?
  twitterUrl        String?
  
  // Preferences
  openToWork        Boolean   @default(false)
  preferredJobTypes Json?     // Array of JobType strings
  salaryMin         Int?
  salaryMax         Int?
  remotePreference  String?   // "remote", "hybrid", "onsite"
  
  // Safety (for DV survivors)
  isSafeMode        Boolean   @default(false)
  hideFromSearch    Boolean   @default(false)
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}

model Session {
  id           String   @id @default(uuid())
  userId       String
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  token        String   @unique
  refreshToken String?  @unique
  userAgent    String?
  ipAddress    String?
  expiresAt    DateTime
  createdAt    DateTime @default(now())
  
  @@index([userId])
  @@index([token])
}

model VerificationToken {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  token     String   @unique
  type      String   // 'EMAIL_VERIFICATION' | 'PASSWORD_RESET'
  expiresAt DateTime
  createdAt DateTime @default(now())
  
  @@index([userId])
  @@index([token])
}

model PushToken {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  token     String
  platform  String   // 'ios' | 'android' | 'web'
  deviceId  String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  
  @@index([userId])
  @@index([token])
}

model EscrowPayment {
  id              String   @id @default(uuid())
  buyerId         String
  buyer           User     @relation("EscrowBuyer", fields: [buyerId], references: [id])
  sellerId        String
  seller          User     @relation("EscrowSeller", fields: [sellerId], references: [id])
  amount          Int      // in cents
  platformFee     Int      @default(0)
  currency        String   @default("AUD")
  status          String   @default("PENDING") // PENDING, AUTHORIZED, CAPTURED, REFUNDED, FAILED, CANCELED
  stripePaymentIntentId String? @unique
  stripeTransferId      String?
  paymentIntentId       String? @unique  // Alias for lookup
  description     String?
  metadata        Json?
  sessionType     String?  // 'mentor_session' | 'course_purchase' | 'creator_content'
  releasedAt      DateTime?
  capturedAt      DateTime?
  canceledAt      DateTime?
  cancelReason    String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  
  @@index([buyerId])
  @@index([sellerId])
  @@index([status])
}

model UsageLog {
  id        String   @id @default(uuid())
  userId    String
  feature   String
  metadata  Json?
  createdAt DateTime @default(now())
  
  @@index([userId])
  @@index([feature])
  @@index([createdAt])
}

model SafetyIncident {
  id           String    @id @default(uuid())
  userId       String
  type         String    // 'CONTENT_REMOVAL', 'USER_REPORT', 'POLICY_VIOLATION', etc.
  severity     String    @default("LOW") // 'LOW', 'MEDIUM', 'HIGH', 'CRITICAL'
  reason       String?
  reporterId   String?
  contentId    String?
  contentType  String?
  verified     Boolean   @default(false)
  resolvedAt   DateTime?
  resolvedById String?
  metadata     Json?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
  
  @@index([userId])
  @@index([type])
  @@index([severity])
  @@index([verified])
}

model AdminFlag {
  id           String   @id @default(uuid())
  userId       String
  type         String   // 'SAFETY_CONCERN', 'FRAUD', 'POLICY_VIOLATION', etc.
  reason       String?
  severity     String   @default("MEDIUM")
  flaggedById  String
  resolvedAt   DateTime?
  resolvedById String?
  notes        String?
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  
  @@index([userId])
  @@index([type])
  @@index([isActive])
}

// ===========================================
// SKILLS & EXPERIENCE
// ============================================

model Skill {
  id          String      @id @default(uuid())
  name        String      @unique
  category    String?     // "Technical", "Soft Skills", "Industry"
  
  users       UserSkill[]
  jobs        JobSkill[]
  
  createdAt   DateTime    @default(now())
}

model UserSkill {
  id          String   @id @default(uuid())
  userId      String
  skillId     String
  
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  skill       Skill    @relation(fields: [skillId], references: [id], onDelete: Cascade)
  
  level       Int?     // 1-5 proficiency
  endorsed    Int      @default(0) // endorsement count
  
  @@unique([userId, skillId])
}

model Education {
  id            String    @id @default(uuid())
  userId        String
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  institution   String
  degree        String?
  fieldOfStudy  String?
  startDate     DateTime?
  endDate       DateTime?
  current       Boolean   @default(false)
  description   String?   
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([userId])
}

model WorkExperience {
  id            String    @id @default(uuid())
  userId        String
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  company       String
  title         String
  location      String?
  startDate     DateTime
  endDate       DateTime?
  current       Boolean   @default(false)
  description   String?   
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  
  @@index([userId])
}

// ===========================================
// SUBSCRIPTIONS & BILLING
// ===========================================

model Subscription {
  id                    String             @id @default(uuid())
  userId                String             @unique
  user                  User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  tier                  SubscriptionTier   @default(FREE)
  status                SubscriptionStatus @default(ACTIVE)
  
  // Amount
  amount                Decimal?           @db.Decimal(10, 2)
  interval              String?            // "month" | "year"
  
  // Stripe
  stripeCustomerId      String?
  stripeSubscriptionId  String?
  stripePriceId         String?
  currency              String?
  
  // Billing
  currentPeriodStart    DateTime?
  currentPeriodEnd      DateTime?
  cancelAtPeriodEnd     Boolean            @default(false)
  
  createdAt             DateTime           @default(now())
  updatedAt             DateTime           @updatedAt
  
  invoices              Invoice[]
  
  @@index([stripeCustomerId])
  @@index([stripeSubscriptionId])
}

model Invoice {
  id              String    @id @default(uuid())
  invoiceNumber   String    @unique
  userId          String
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  subscriptionId  String?
  subscription    Subscription? @relation(fields: [subscriptionId], references: [id])
  paymentId       String?
  
  amount          Decimal   @db.Decimal(10, 2)
  currency        String    @default("AUD")
  status          String    @default("DRAFT") // DRAFT, SENT, PAID, OVERDUE, CANCELLED
  
  pdfUrl          String?
  issuedAt        DateTime?
  dueAt           DateTime?
  paidAt          DateTime?
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@index([userId])
  @@index([subscriptionId])
  @@index([invoiceNumber])
}

model Payment {
  id                    String   @id @default(uuid())
  userId                String
  user                  User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  amount                Decimal  @db.Decimal(10, 2)
  currency              String   @default("AUD")
  status                String   @default("PENDING") // PENDING, PROCESSING, COMPLETED, FAILED, REFUNDED
  method                String?  // "card", "bank_transfer", "paypal"
  
  // Stripe
  stripePaymentIntentId String?  @unique
  stripeChargeId        String?
  
  // References
  type                  String?  // "subscription", "course", "service", "gift"
  referenceId           String?  // ID of the related entity
  
  createdAt             DateTime @default(now())
  updatedAt             DateTime @updatedAt
  
  @@index([userId])
  @@index([status])
  @@index([stripePaymentIntentId])
}

// ===========================================
// JOBS & APPLICATIONS
// ===========================================

model Organization {
  id              String    @id @default(uuid())
  
  name            String
  slug            String    @unique
  description     String?   
  logo            String?
  banner          String?
  website         String?
  
  // Location
  city            String?
  state           String?
  country         String    @default("Australia")
  
  // Type
  type            String?   // "company", "university", "tafe", "government", "ngo"
  industry        String?
  size            String?   // "1-10", "11-50", etc.
  
  // Verification
  isVerified      Boolean   @default(false)
  safetyScore     Int?      // 0-100
  
  // Social
  followerCount   Int       @default(0)
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  jobs            Job[]
  courses         Course[]
  educationApplications EducationApplication[]
  apprenticeshipsAsRto Apprenticeship[] @relation("ApprenticeshipRto")
  apprenticeshipsAsHost Apprenticeship[] @relation("ApprenticeshipHost")
  providerOutcomes ProviderOutcome[]
  members         OrganizationMember[]

  // Finance
  accountingAccounts AccountingAccount[]
  journalEntries     JournalEntry[]
  taxRates           TaxRate[]
  taxReturns         TaxReturn[]
  inventoryItems     InventoryItem[]
  inventoryLocations InventoryLocation[]
  moneyTransactions  MoneyTransaction[]
  
  // Branding (Enterprise)
  brandColor      String?   // Primary brand color hex
  customDomain    String?   // Custom career page domain
  
  // Analytics
  viewCount       Int       @default(0)
  jobViewCount    Int       @default(0)
  applicationCount Int      @default(0)
  
  // Phase 11: Disability Support
  disabilityFriendlyListings DisabilityFriendlyEmployer[]
  
  @@index([slug])
  @@index([type])
}

enum OrganizationRole {
  OWNER
  ADMIN
  RECRUITER
  VIEWER
}

model OrganizationMember {
  id              String           @id @default(uuid())
  organizationId  String
  userId          String
  role            OrganizationRole @default(VIEWER)
  
  organization    Organization     @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Permissions
  canPostJobs     Boolean          @default(false)
  canManageTeam   Boolean          @default(false)
  canViewAnalytics Boolean         @default(true)
  
  invitedAt       DateTime         @default(now())
  acceptedAt      DateTime?
  
  @@unique([organizationId, userId])
  @@index([organizationId])
  @@index([userId])
}

model Job {
  id              String        @id @default(uuid())
  
  // Basics
  title           String
  slug            String        @unique
  description     String        
  
  // Organization
  organizationId  String?
  organization    Organization? @relation(fields: [organizationId], references: [id])
  postedById      String
  postedBy        User          @relation("PostedJobs", fields: [postedById], references: [id])
  
  // Details
  type            JobType       @default(FULL_TIME)
  status          JobStatus     @default(DRAFT)
  
  // Location
  city            String?
  state           String?
  country         String        @default("Australia")
  isRemote        Boolean       @default(false)
  
  // Compensation
  salaryMin       Int?
  salaryMax       Int?
  salaryType      String?       // "annual", "hourly"
  showSalary      Boolean       @default(true)
  
  // Requirements
  experienceMin   Int?
  experienceMax   Int?
  
  // Dates
  deadline        DateTime?
  publishedAt     DateTime?
  closedAt        DateTime?
  
  // Stats
  viewCount       Int           @default(0)
  applicationCount Int          @default(0)
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  
  skills          JobSkill[]
  applications    JobApplication[]
  savedBy         SavedJob[]
  
  @@index([status])
  @@index([type])
  @@index([organizationId])
  @@index([city, state, country])
}

model JobSkill {
  id        String   @id @default(uuid())
  jobId     String
  skillId   String
  
  job       Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  skill     Skill    @relation(fields: [skillId], references: [id], onDelete: Cascade)
  
  required  Boolean  @default(true)
  
  @@unique([jobId, skillId])
}

model JobApplication {
  id            String            @id @default(uuid())
  jobId         String
  userId        String
  
  job           Job               @relation(fields: [jobId], references: [id], onDelete: Cascade)
  user          User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  status        ApplicationStatus @default(PENDING)
  
  coverLetter   String?           
  resumeUrl     String?
  
  // Reference check fields
  referenceStatus    String?       // "PENDING", "PARTIAL", "COMPLETE"
  referencesReceived Int           @default(0)
  referencesTotal    Int           @default(0)
  referenceRequests  ReferenceRequest[]
  
  appliedAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  
  @@unique([jobId, userId])
  @@index([jobId])
  @@index([userId])
  @@index([status])
}

model ReferenceRequest {
  id              String    @id @default(uuid())
  candidateId     String
  candidate       User      @relation("CandidateReferences", fields: [candidateId], references: [id], onDelete: Cascade)
  applicationId   String?
  application     JobApplication? @relation(fields: [applicationId], references: [id], onDelete: SetNull)
  
  // Referee info
  refereeEmail    String
  refereeName     String
  refereeTitle    String?
  refereeCompany  String?
  relationship    String    // "MANAGER", "COLLEAGUE", "CLIENT", etc.
  type            String    // "PROFESSIONAL", "CHARACTER", "ACADEMIC"
  
  // Status tracking
  status          String    @default("PENDING") // PENDING, SENT, VIEWED, IN_PROGRESS, COMPLETED, EXPIRED
  token           String    @unique @default(uuid())
  sentAt          DateTime?
  viewedAt        DateTime?
  completedAt     DateTime?
  expiresAt       DateTime?
  lastReminderAt  DateTime?
  
  // Response data
  responses       Json?     // Structured response data
  overallRating   Int?      // 1-5 scale
  feedback        String?   // Free-form feedback
  
  // Custom questions
  customQuestions Json?
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@index([candidateId])
  @@index([applicationId])
  @@index([status])
  @@index([token])
}

model SavedJob {
  id        String   @id @default(uuid())
  userId    String
  jobId     String
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  job       Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)
  
  savedAt   DateTime @default(now())
  
  @@unique([userId, jobId])
  @@index([userId])
  @@index([jobId])
}

// ===========================================
// SOCIAL & COMMUNITY
// ===========================================

model Post {
  id            String      @id @default(uuid())
  authorId      String
  author        User        @relation(fields: [authorId], references: [id], onDelete: Cascade)
  
  type          PostType    @default(TEXT)
  content       String      
  
  // Media
  mediaUrls     Json?       // Array of media URLs
  
  // Engagement
  likeCount     Int         @default(0)
  commentCount  Int         @default(0)
  shareCount    Int         @default(0)
  viewCount     Int         @default(0)
  
  // Visibility
  isPublic      Boolean     @default(true)
  isPinned      Boolean     @default(false)
  
  // Moderation
  isHidden      Boolean     @default(false)
  reportCount   Int         @default(0)
  
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt
  
  comments      Comment[]
  likes         Like[]
  
  @@index([authorId])
  @@index([createdAt])
}

model Comment {
  id          String    @id @default(uuid())
  postId      String
  authorId    String
  
  post        Post      @relation(fields: [postId], references: [id], onDelete: Cascade)
  author      User      @relation(fields: [authorId], references: [id], onDelete: Cascade)
  
  content     String    
  
  // Nested comments
  parentId    String?
  parent      Comment?  @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies     Comment[] @relation("CommentReplies")
  
  likeCount   Int       @default(0)
  
  // Moderation
  isHidden    Boolean   @default(false)
  reportCount Int       @default(0)
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  @@index([postId])
  @@index([authorId])
}

model Like {
  id        String   @id @default(uuid())
  userId    String
  postId    String
  
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  
  createdAt DateTime @default(now())
  
  @@unique([userId, postId])
}

model Follow {
  id          String   @id @default(uuid())
  followerId  String
  followingId String
  
  follower    User     @relation("Followers", fields: [followerId], references: [id], onDelete: Cascade)
  following   User     @relation("Following", fields: [followingId], references: [id], onDelete: Cascade)
  
  createdAt   DateTime @default(now())
  
  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
}

model Group {
  id                 String       @id @default(uuid())
  name               String
  description        String
  privacy            GroupPrivacy @default(PUBLIC)
  isFeatured         Boolean      @default(false)
  isPinned           Boolean      @default(false)
  isHidden           Boolean      @default(false)
  allowMemberInvites Boolean      @default(true)
  requireApproval    Boolean      @default(false)
  maxMembers         Int          @default(1000)
  createdById        String
  createdBy          User         @relation("GroupsCreated", fields: [createdById], references: [id], onDelete: Cascade)
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt

  members            GroupMember[]
  posts              GroupPost[]
  joinRequests       GroupJoinRequest[]

  @@index([privacy])
  @@index([createdById])
}

model GroupJoinRequest {
  id           String                 @id @default(uuid())
  groupId      String
  userId       String
  status       GroupJoinRequestStatus @default(PENDING)
  reviewedAt   DateTime?
  reviewedById String?
  invitedById  String?                // User who invited this person

  group        Group                  @relation(fields: [groupId], references: [id], onDelete: Cascade)
  user         User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  reviewedBy   User?                  @relation("GroupJoinRequestsReviewed", fields: [reviewedById], references: [id], onDelete: SetNull)

  createdAt    DateTime               @default(now())
  updatedAt    DateTime               @updatedAt

  @@unique([groupId, userId])
  @@index([groupId, status])
  @@index([userId])
}

model GroupMember {
  id           String    @id @default(uuid())
  groupId      String
  userId       String
  role         GroupRole @default(MEMBER)
  joinedAt     DateTime  @default(now())
  isMuted      Boolean   @default(false)
  isBanned     Boolean   @default(false)
  mutedUntil   DateTime?
  bannedReason String?

  group        Group     @relation(fields: [groupId], references: [id], onDelete: Cascade)
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([groupId, userId])
  @@index([groupId])
  @@index([userId])
}

model GroupPost {
  id        String   @id @default(uuid())
  groupId   String
  authorId  String
  content   String
  createdAt DateTime @default(now())

  group     Group    @relation(fields: [groupId], references: [id], onDelete: Cascade)
  author    User     @relation(fields: [authorId], references: [id], onDelete: Cascade)

  @@index([groupId, createdAt])
  @@index([authorId])
}

model Event {
  id            String      @id @default(uuid())
  title         String
  description   String
  type          EventType
  format        EventFormat
  isFeatured    Boolean     @default(false)
  isPinned      Boolean     @default(false)
  isHidden      Boolean     @default(false)
  date          DateTime
  startTime     String
  endTime       String
  location      String?
  link          String?
  image         String
  hostName      String
  hostTitle     String
  hostAvatar    String
  baseAttendees Int         @default(0)
  maxAttendees  Int?
  price         Int         @default(0)
  tags          String[]
  createdAt     DateTime    @default(now())
  updatedAt     DateTime    @updatedAt

  registrations EventRegistration[]
  saves         EventSave[]

  @@index([type])
  @@index([date])
}

model EventRegistration {
  id        String   @id @default(uuid())
  eventId   String
  userId    String
  createdAt DateTime @default(now())

  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([eventId, userId])
  @@index([eventId])
  @@index([userId])
}

model EventSave {
  id        String   @id @default(uuid())
  eventId   String
  userId    String
  createdAt DateTime @default(now())

  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([eventId, userId])
  @@index([eventId])
  @@index([userId])
}

// ===========================================
// SUPER APP VIDEO & CHANNELS
// ===========================================

model Video {
  id               String       @id @default(uuid())
  authorId         String
  author           User         @relation(fields: [authorId], references: [id], onDelete: Cascade)

  title            String?
  description      String?
  type             VideoType    @default(REEL)
  status           VideoStatus  @default(PROCESSING)
  videoUrl         String
  thumbnailUrl     String?
  duration         Int?
  aspectRatio      String?
  audioTrackId     String?
  captionsUrl      String?
  hasAutoCaption   Boolean      @default(false)

  viewCount        Int          @default(0)
  likeCount        Int          @default(0)
  commentCount     Int          @default(0)
  shareCount       Int          @default(0)
  saveCount        Int          @default(0)
  completionRate   Float?
  engagementScore  Float?
  relevanceScore   Float?
  opportunityScore Float?
  safetyScore      Float?

  isMonetized      Boolean      @default(false)
  adRevenue        Int          @default(0)
  giftRevenue      Int          @default(0)
  productTags      Json?

  isHidden         Boolean      @default(false)
  reportCount      Int          @default(0)
  moderationFlags  Json?
  hashtags         String[]
  mentionedUserIds String[]
  location         String?

  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  publishedAt      DateTime?
  expiresAt        DateTime?

  likes            VideoLike[]
  comments         VideoComment[]
  saves            VideoSave[]
  views            VideoView[]

  @@index([authorId])
  @@index([status])
  @@index([type])
  @@index([createdAt])
  @@index([engagementScore])
}

model VideoLike {
  id        String   @id @default(uuid())
  videoId   String
  userId    String
  createdAt DateTime @default(now())

  video     Video    @relation(fields: [videoId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([videoId, userId])
  @@index([videoId])
  @@index([userId])
}

model VideoComment {
  id        String    @id @default(uuid())
  videoId   String
  authorId  String
  content   String
  parentId  String?
  likeCount Int       @default(0)
  isPinned  Boolean   @default(false)
  isHidden  Boolean   @default(false)
  createdAt DateTime  @default(now())

  video     Video     @relation(fields: [videoId], references: [id], onDelete: Cascade)
  author    User      @relation(fields: [authorId], references: [id], onDelete: Cascade)
  parent    VideoComment? @relation("VideoCommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies   VideoComment[] @relation("VideoCommentReplies")

  @@index([videoId])
  @@index([authorId])
}

model VideoSave {
  id        String   @id @default(uuid())
  videoId   String
  userId    String
  createdAt DateTime @default(now())

  video     Video    @relation(fields: [videoId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([videoId, userId])
}

model VideoView {
  id            String   @id @default(uuid())
  videoId       String
  userId        String?
  watchDuration Int
  completionPct Float
  source        String?
  createdAt     DateTime @default(now())

  video         Video    @relation(fields: [videoId], references: [id], onDelete: Cascade)

  @@index([videoId])
  @@index([userId])
  @@index([createdAt])
}

model AudioTrack {
  id         String   @id @default(uuid())
  title      String
  artist     String?
  audioUrl   String
  duration   Int
  useCount   Int      @default(0)
  isOriginal Boolean  @default(false)
  licenseType String?
  createdAt  DateTime @default(now())

  @@index([useCount])
}

model Channel {
  id           String      @id @default(uuid())
  name         String
  description  String?
  type         ChannelType
  ownerId      String
  owner        User        @relation("ChannelOwner", fields: [ownerId], references: [id], onDelete: Cascade)
  isPublic     Boolean     @default(true)
  allowReplies Boolean     @default(false)
  memberCount  Int         @default(0)
  messageCount Int         @default(0)
  avatarUrl    String?
  bannerUrl    String?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt

  members      ChannelMember[]
  messages     ChannelMessage[]

  @@index([type])
  @@index([ownerId])
}

model ChannelMember {
  id        String   @id @default(uuid())
  channelId String
  userId    String
  isMuted   Boolean  @default(false)
  joinedAt  DateTime @default(now())

  channel   Channel  @relation(fields: [channelId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([channelId, userId])
  @@index([channelId])
  @@index([userId])
}

model ChannelMessage {
  id         String   @id @default(uuid())
  channelId  String
  authorId   String
  content    String
  mediaUrls  Json?
  readCount  Int      @default(0)
  reactionCount Int   @default(0)
  isPinned   Boolean  @default(false)
  createdAt  DateTime @default(now())

  channel    Channel  @relation(fields: [channelId], references: [id], onDelete: Cascade)
  author     User     @relation(fields: [authorId], references: [id], onDelete: Cascade)

  @@index([channelId])
  @@index([createdAt])
}

model Status {
  id        String     @id @default(uuid())
  userId    String
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  type      StatusType @default(IMAGE)
  mediaUrl  String

  createdAt DateTime   @default(now())
  expiresAt DateTime

  @@index([userId])
  @@index([expiresAt])
  @@index([createdAt])
}

model Referral {
  id            String         @id @default(uuid())
  referrerId    String
  referredId    String         @unique
  
  referrer      User           @relation("ReferrerUser", fields: [referrerId], references: [id], onDelete: Cascade)
  referred      User           @relation("ReferredUser", fields: [referredId], references: [id], onDelete: Cascade)
  
  status        ReferralStatus @default(PENDING)
  rewardGranted Boolean        @default(false)
  
  // Tracking
  signupSource  String?        // "email", "whatsapp", "twitter", "link"
  
  createdAt     DateTime       @default(now())
  completedAt   DateTime?
  
  @@index([referrerId])
}

model Conversation {
  id            String    @id @default(uuid())
  participants  ConversationParticipant[]
  messages      Message[] @relation("ConversationMessages")
  
  lastMessageAt DateTime  @default(now())
  lastMessageId String?
  messageCount  Int       @default(0)
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model ConversationParticipant {
  id              String       @id @default(uuid())
  conversationId  String
  userId          String
  user            User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  conversation    Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  
  hasUnread       Boolean      @default(false)
  unreadCount     Int          @default(0)
  lastReadAt      DateTime     @default(now())
  lastReadMessageId String?    // ID of the last read message
  
  joinedAt        DateTime     @default(now())
  
  @@unique([conversationId, userId])
  @@index([userId])
}

model Message {
  id              String       @id @default(uuid())
  conversationId  String?      // Optional for migration compatibility, but should be required
  conversation    Conversation? @relation("ConversationMessages", fields: [conversationId], references: [id], onDelete: Cascade)
  
  senderId        String
  receiverId      String?      // Deprecated if using conversation, optional for group chats
  
  sender          User         @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  receiver        User?        @relation("ReceivedMessages", fields: [receiverId], references: [id], onDelete: Cascade)
  
  // Reply support
  replyToId       String?
  replyTo         Message?     @relation("MessageReplies", fields: [replyToId], references: [id], onDelete: SetNull)
  replies         Message[]    @relation("MessageReplies")
  
  // Reactions
  reactions       MessageReaction[]
  
  content         String   
  type            String?      // "TEXT", "IMAGE", "FILE", "SYSTEM"
  metadata        Json?        // Additional message metadata
  partitionKey    String?      // Date-based partition key for archival
  isRead          Boolean      @default(false)
  readAt          DateTime?
  editedAt        DateTime?    // Message edit timestamp
  deletedAt       DateTime?    // Soft delete support
  isArchived      Boolean      @default(false) // Archive status
  
  createdAt       DateTime     @default(now())
  
  @@index([conversationId])
  @@index([senderId])
  @@index([receiverId])
  @@index([createdAt])
  @@index([isArchived])
  @@index([replyToId])
  @@index([partitionKey])
}

model MessageReaction {
  id        String   @id @default(uuid())
  messageId String
  message   Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)
  userId    String
  emoji     String   // Unicode emoji or custom emoji code
  createdAt DateTime @default(now())
  
  @@unique([messageId, userId, emoji])
  @@index([messageId])
  @@index([userId])
}

model Notification {
  id          String           @id @default(uuid())
  userId      String
  user        User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type        NotificationType
  title       String
  message     String?
  link        String?
  data        Json?
  
  isRead      Boolean          @default(false)
  readAt      DateTime?
  
  createdAt   DateTime         @default(now())
  
  @@index([userId])
  @@index([createdAt])
}

model VerificationBadge {
  id            String              @id @default(uuid())
  userId        String
  type          VerificationBadgeType
  status        VerificationStatus  @default(PENDING)
  metadata      Json?
  reason        String?
  submittedAt   DateTime            @default(now())
  reviewedAt    DateTime?
  reviewedById  String?

  user          User                @relation("VerificationApplicant", fields: [userId], references: [id], onDelete: Cascade)
  reviewedBy    User?               @relation("VerificationReviewer", fields: [reviewedById], references: [id])

  @@index([userId])
  @@index([type, status])
}

model Appeal {
  id            String       @id @default(uuid())
  userId        String
  type          AppealType
  status        AppealStatus @default(PENDING)
  reason        String
  metadata      Json?
  decisionNote  String?
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  reviewedAt    DateTime?
  reviewedById  String?

  user          User         @relation("AppealRequester", fields: [userId], references: [id], onDelete: Cascade)
  reviewedBy    User?        @relation("AppealReviewer", fields: [reviewedById], references: [id])

  @@index([userId])
  @@index([status])
}

// ===========================================
// CREATORS & MENTORS
// ===========================================

model CreatorProfile {
  id              String    @id @default(uuid())
  userId          String    @unique
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Monetization
  stripeAccountId String?
  isMonetized     Boolean   @default(false)
  
  // Stats
  followerCount   Int       @default(0)
  totalEarnings   Int       @default(0)  // In gift points
  pendingPayout   Int       @default(0)  // In gift points
  
  // Creator Fund
  isEligible      Boolean   @default(false)
  tier            String?   // "emerging", "rising", "established", "partner"
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  payouts         CreatorPayout[]
}

model MentorProfile {
  id              String    @id @default(uuid())
  userId          String    @unique
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Expertise
  specializations Json?     // Array of specialization strings
  yearsExperience Int?
  
  // Availability
  hourlyRate      Decimal?  
  isAvailable     Boolean   @default(true)
  
  // Stats
  sessionCount    Int       @default(0)
  rating          Decimal?  
  reviewCount     Int       @default(0)

  // Monetization
  stripeAccountId String?
  isMonetized     Boolean   @default(false)
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  sessions        MentorSession[] @relation("MentorSessions")
}

// ===========================================
// EDUCATION & COURSES
// ===========================================

model Course {
  id              String        @id @default(uuid())
  
  title           String
  slug            String        @unique
  description     String        
  
  // Provider
  organizationId  String?
  organization    Organization? @relation(fields: [organizationId], references: [id])
  providerName    String?
  
  // Details
  type            String?       // "degree", "diploma", "certificate", "bootcamp", "short_course"
  durationMonths  Int?
  studyMode       Json?         // Array: ["full-time", "part-time", "online"]
  
  // Cost
  cost            Int?
  fundingOptions  Json?         // Array: ["HECS-HELP", "VET Student Loans"]
  
  // Outcomes
  employmentRate  Int?          // percentage
  avgStartingSalary Int?
  
  // Dates
  intakeDates     Json?         // Array of ISO date strings
  
  isActive        Boolean       @default(true)
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  enrollments     CourseEnrollment[]
  educationApplications EducationApplication[]
  
  @@index([organizationId])
  @@index([type])
}

model CourseEnrollment {
  id        String   @id @default(uuid())
  userId    String
  courseId  String
  progress  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@unique([userId, courseId])
  @@index([userId])
  @@index([courseId])
}

enum EducationApplicationStatus {
  SUBMITTED
  IN_REVIEW
  ACCEPTED
  REJECTED
  WITHDRAWN
}

model EducationApplication {
  id             String                     @id @default(uuid())
  userId         String
  organizationId String
  courseId       String?

  // If courseId isn't provided (e.g. applying to a program/listing), store a label.
  programName    String?
  intakeDate     DateTime?

  status         EducationApplicationStatus @default(SUBMITTED)
  notes          String?

  submittedAt    DateTime                   @default(now())
  updatedAt      DateTime                   @updatedAt

  user           User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  organization   Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)
  course         Course?      @relation(fields: [courseId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([organizationId])
  @@index([courseId])
  @@index([status])
}

// ===========================================
// APPRENTICESHIPS & SKILLS MARKETPLACE
// ===========================================

model Apprenticeship {
  id                 String                @id @default(uuid())
  title              String
  slug               String                @unique
  description        String
  framework          String
  level              ApprenticeshipLevel
  durationMonths     Int
  wageMin            Int?
  wageMax            Int?
  wagePostCompletion Int?
  rtoId              String?
  hostEmployerId     String?
  city               String?
  state              String?
  country            String                @default("Australia")
  isRemote           Boolean               @default(false)
  competencies       Json?
  completionRate     Int?
  employmentRate     Int?
  womenEnrolled      Int?
  totalEnrolled      Int?
  status             ApprenticeshipStatus  @default(DRAFT)
  positions          Int                   @default(1)
  positionsFilled    Int                   @default(0)
  startDate          DateTime?
  applicationDeadline DateTime?
  publishedAt        DateTime?
  createdAt          DateTime              @default(now())
  updatedAt          DateTime              @updatedAt

  rto                Organization?         @relation("ApprenticeshipRto", fields: [rtoId], references: [id], onDelete: SetNull)
  hostEmployer       Organization?         @relation("ApprenticeshipHost", fields: [hostEmployerId], references: [id], onDelete: SetNull)
  applications       ApprenticeshipApplication[]

  @@index([framework])
  @@index([level])
  @@index([status])
  @@index([rtoId])
  @@index([hostEmployerId])
}

model ApprenticeshipApplication {
  id               String                          @id @default(uuid())
  apprenticeshipId String
  userId           String
  status           ApprenticeshipApplicationStatus @default(SUBMITTED)
  coverLetter      String?
  resumeUrl        String?
  answers          Json?
  submittedAt      DateTime                        @default(now())
  updatedAt        DateTime                        @updatedAt

  apprenticeship   Apprenticeship @relation(fields: [apprenticeshipId], references: [id], onDelete: Cascade)
  user             User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([apprenticeshipId, userId])
  @@index([apprenticeshipId])
  @@index([userId])
  @@index([status])
}

model SkillService {
  id              String        @id @default(uuid())
  providerId      String
  title           String
  description     String
  category        ServiceCategory
  status          ServiceStatus @default(ACTIVE)
  hourlyRate      Int
  minimumHours    Float         @default(1)
  isAvailable     Boolean       @default(true)
  availabilityJson Json?
  completedCount  Int           @default(0)
  rating          Float?
  reviewCount     Int           @default(0)
  tags            String[]
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  provider        User          @relation(fields: [providerId], references: [id], onDelete: Cascade)
  bookings        ServiceBooking[]
  reviews         ServiceReview[]

  @@index([providerId])
  @@index([category])
  @@index([status])
  @@index([rating])
}

model ServiceBooking {
  id                 String        @id @default(uuid())
  serviceId          String
  clientId           String
  status             BookingStatus @default(PENDING)
  scheduledAt        DateTime
  durationMinutes    Int
  totalAmount        Int
  platformFee        Int
  providerPayout     Int
  clientNotes        String?
  providerNotes      String?
  stripePaymentIntentId String?
  paidAt             DateTime?
  payoutAt           DateTime?
  createdAt          DateTime      @default(now())
  updatedAt          DateTime      @updatedAt
  completedAt        DateTime?

  service            SkillService  @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  client             User          @relation("ServiceBookingsClient", fields: [clientId], references: [id], onDelete: Cascade)

  @@index([serviceId])
  @@index([clientId])
  @@index([status])
  @@index([scheduledAt])
}

model ServiceReview {
  id          String   @id @default(uuid())
  serviceId   String
  clientId    String
  bookingId   String?
  rating      Int
  content     String?
  response    String?
  respondedAt DateTime?
  isHidden    Boolean  @default(false)
  createdAt   DateTime @default(now())

  service     SkillService @relation(fields: [serviceId], references: [id], onDelete: Cascade)
  client      User         @relation(fields: [clientId], references: [id], onDelete: Cascade)

  @@unique([serviceId, clientId, bookingId])
  @@index([serviceId])
  @@index([clientId])
}

model UserOutcome {
  id             String   @id @default(uuid())
  userId         String
  type           String
  previousValue  Int?
  newValue       Int?
  changePercent  Float?
  jobId          String?
  courseId       String?
  apprenticeshipId String?
  achievedAt     DateTime @default(now())

  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([type])
  @@index([achievedAt])
}

model ProviderOutcome {
  id                String   @id @default(uuid())
  organizationId    String
  periodStart       DateTime
  periodEnd         DateTime
  enrollments       Int      @default(0)
  completions       Int      @default(0)
  completionRate    Float?
  placementCount    Int      @default(0)
  placementRate     Float?
  avgSalary         Int?
  medianSalary      Int?
  womenEnrolled     Int      @default(0)
  indigenousEnrolled Int     @default(0)
  createdAt         DateTime @default(now())

  organization      Organization @relation(fields: [organizationId], references: [id], onDelete: Cascade)

  @@index([organizationId])
  @@index([periodStart, periodEnd])
}

model MentorSession {
  id              String             @id @default(uuid())
  mentorProfileId String
  menteeId        String
  scheduledAt     DateTime?
  durationMinutes Int                @default(60)
  status          MentorSessionStatus @default(REQUESTED)
  note            String?
  currency        String             @default("AUD")
  sessionAmount   Decimal            @default(0)
  platformFee     Decimal            @default(0)
  mentorPayout    Decimal            @default(0)
  stripePaymentIntentId String?      @unique
  paymentStatus   MentorPaymentStatus @default(PENDING)
  paymentAuthorizedAt DateTime?
  paymentCapturedAt  DateTime?
  paymentCanceledAt  DateTime?
  paymentFailedAt    DateTime?
  createdAt       DateTime           @default(now())
  updatedAt       DateTime           @updatedAt

  mentorProfile   MentorProfile @relation("MentorSessions", fields: [mentorProfileId], references: [id], onDelete: Cascade)
  mentee          User          @relation("MenteeSessions", fields: [menteeId], references: [id], onDelete: Cascade)

  @@index([mentorProfileId])
  @@index([menteeId])
  @@index([status])
  @@index([scheduledAt])
  @@index([paymentStatus])
}

// ===========================================
// AUDIT LOGS (Compliance)
// ===========================================

model AuditLog {
  id           String      @id @default(uuid())
  action       AuditAction

  actorUserId  String?
  actorUser    User?       @relation("AuditLogActorUser", fields: [actorUserId], references: [id], onDelete: SetNull)

  targetUserId String?
  targetUser   User?       @relation("AuditLogTargetUser", fields: [targetUserId], references: [id], onDelete: SetNull)

  ipAddress    String?
  userAgent    String?
  metadata     Json?

  createdAt    DateTime    @default(now())

  @@index([action])
  @@index([actorUserId])
  @@index([targetUserId])
  @@index([createdAt])
}

// ===========================================
// CREATOR ECONOMY
// ===========================================

model GiftBalancePurchase {
  id              String   @id @default(uuid())
  userId          String
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  paymentIntentId String   @unique
  amountCents     Int
  giftPoints      Int

  createdAt       DateTime @default(now())

  @@index([userId])
  @@index([createdAt])
}

model StripeWebhookEvent {
  id          String   @id
  type        String
  processedAt DateTime @default(now())

  @@index([type])
  @@index([processedAt])
}

model GiftTransaction {
  id            String    @id @default(uuid())
  senderId      String
  receiverId    String
  
  sender        User      @relation("GiftsSent", fields: [senderId], references: [id], onDelete: Cascade)
  receiver      User      @relation("GiftsReceived", fields: [receiverId], references: [id], onDelete: Cascade)
  
  giftType      String    // "spark", "star", "rocket", "crown", "diamond", "trophy"
  giftValue     Int       // Gift points
  creatorShare  Int       // Points going to creator
  platformShare Int       // Points kept by platform
  
  message       String?
  
  createdAt     DateTime  @default(now())
  
  @@index([senderId])
  @@index([receiverId])
  @@index([createdAt])
}

model CreatorPayout {
  id                String    @id @default(uuid())
  creatorProfileId  String
  creatorProfile    CreatorProfile @relation(fields: [creatorProfileId], references: [id], onDelete: Cascade)
  
  amount            Float     // In AUD
  stripeTransferId  String?
  status            String    @default("PENDING") // PENDING, PROCESSING, COMPLETED, FAILED
  
  createdAt         DateTime  @default(now())
  completedAt       DateTime?
  
  @@index([creatorProfileId])
  @@index([status])
}

// ===========================================
// ENGAGEMENT & GAMIFICATION
// ===========================================

model UserStreak {
  id               String    @id @default(uuid())
  userId           String
  user             User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type             String    // "post", "login", "learn"
  currentStreak    Int       @default(0)
  longestStreak    Int       @default(0)
  lastActivityDate DateTime
  
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  
  @@unique([userId, type])
  @@index([userId])
  @@index([type])
}

model UserAchievement {
  id            String    @id @default(uuid())
  userId        String
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  achievementId String    // Achievement type ID
  earnedAt      DateTime  @default(now())
  
  @@unique([userId, achievementId])
  @@index([userId])
  @@index([achievementId])
}

model XpTransaction {
  id        String    @id @default(uuid())
  userId    String
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  amount    Int       // Positive for gains, negative for spends
  reason    String
  balance   Int       // Running balance after transaction
  
  createdAt DateTime  @default(now())
  
  @@index([userId])
  @@index([createdAt])
}

// ===========================================
// BUSINESS FORMATION (FORMATION STUDIO)
// ===========================================

model BusinessRegistration {
  id        String    @id @default(uuid())
  userId    String
  user      User      @relation(fields: [userId], references: [id])
  type      BusinessType
  status    BusinessStatus @default(DRAFT)
  
  // Registration Data
  businessName String?
  abn         String?
  acn         String?
  
  // JSON Data for remaining fields (directors, address, etc.)
  data         Json?
  stateHistory Json?   // Array of state transitions
  
  // Generated Documents (stored as URLs or JSON)
  documents Json?
  
  submittedAt DateTime?
  approvedAt  DateTime?
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum BusinessType {
  SOLE_TRADER
  PARTNERSHIP
  COMPANY
  TRUST
}

enum BusinessStatus {
  DRAFT
  DETAILS_COMPLETE
  PEOPLE_ADDED
  ADDRESS_VERIFIED
  DOCUMENTS_UPLOADED
  PAYMENT_PENDING
  PAYMENT_COMPLETE
  PENDING_PAYMENT
  PAID
  SUBMITTED
  UNDER_REVIEW
  ADDITIONAL_INFO_REQUIRED
  NEEDS_INFO
  APPROVED
  REJECTED
  COMPLETED
}

// ===========================================
// PHASE 4: GDPR & COMPLIANCE
// ===========================================

enum ConsentType {
  MARKETING_EMAIL
  MARKETING_SMS
  MARKETING_PUSH
  DATA_PROCESSING
  ANALYTICS
  PERSONALIZATION
  THIRD_PARTY_SHARING
  COOKIE_ESSENTIAL
  COOKIE_ANALYTICS
  COOKIE_MARKETING
  COOKIE_FUNCTIONAL
}

enum ConsentStatus {
  GRANTED
  DENIED
  WITHDRAWN
}

enum DSARType {
  EXPORT
  DELETION
  RECTIFICATION
  RESTRICTION
  PORTABILITY
}

enum DSARStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  REJECTED
  EXPIRED
}

enum DataCategory {
  PII
  SENSITIVE
  FINANCIAL
  UGC
  BIOMETRIC
  BEHAVIORAL
  TECHNICAL
}

enum LegalBasis {
  CONSENT
  CONTRACT
  LEGAL_OBLIGATION
  VITAL_INTERESTS
  PUBLIC_TASK
  LEGITIMATE_INTERESTS
}

enum BreachSeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum BreachStatus {
  DETECTED
  INVESTIGATING
  CONTAINED
  NOTIFIED
  RESOLVED
  CLOSED
}

// Consent Ledger - Tracks all user consents with timestamps
model ConsentRecord {
  id            String        @id @default(uuid())
  userId        String
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  consentType   ConsentType
  status        ConsentStatus
  version       String        // Policy version consented to
  
  ipAddress     String?
  userAgent     String?
  region        String?       // Detected region (UK, EU, US, etc.)
  
  grantedAt     DateTime?
  withdrawnAt   DateTime?
  expiresAt     DateTime?
  
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  
  @@unique([userId, consentType])
  @@index([userId])
  @@index([consentType])
  @@index([status])
  @@index([region])
}

// DSAR (Data Subject Access Request) Management
model DSARRequest {
  id              String      @id @default(uuid())
  userId          String
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type            DSARType
  status          DSARStatus  @default(PENDING)
  
  // Request details
  requestDetails  String?     @db.Text
  identityVerified Boolean    @default(false)
  
  // Processing info
  assignedTo      String?     // Admin user ID handling request
  processingNotes String?     @db.Text
  
  // Export/result data
  exportUrl       String?     // Secure download URL for export
  exportExpiresAt DateTime?
  
  // Timing
  requestedAt     DateTime    @default(now())
  acknowledgedAt  DateTime?   // Must acknowledge within 72 hours
  dueDate         DateTime    // Must complete within 30 days
  completedAt     DateTime?
  
  // Audit
  auditLogId      String?
  
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  
  @@index([userId])
  @@index([status])
  @@index([type])
  @@index([dueDate])
}

// Records of Processing Activities (RoPA)
model ProcessingActivity {
  id                  String        @id @default(uuid())
  
  // Activity identification
  name                String
  description         String        @db.Text
  department          String        // e.g., "Marketing", "Product", "HR"
  
  // Data subjects
  dataSubjectCategories String[]    // e.g., ["Users", "Employees", "Vendors"]
  
  // Data categories
  dataCategories      DataCategory[]
  dataElements        String[]      // Specific fields: ["email", "name", "address"]
  
  // Legal basis
  legalBasis          LegalBasis
  legalBasisDetails   String?       @db.Text
  
  // Purpose
  purposes            String[]
  
  // Recipients & transfers
  recipients          String[]      // Internal departments or external parties
  thirdCountryTransfers String[]    // Countries outside EU/UK
  transferSafeguards  String?       // SCCs, adequacy decision, etc.
  
  // Retention
  retentionPeriod     String        // e.g., "3 years after account closure"
  retentionJustification String?
  
  // Security measures
  securityMeasures    String[]
  
  // DPIA required?
  dpiaRequired        Boolean       @default(false)
  dpiaId              String?
  
  // Subprocessors
  subprocessors       String[]
  
  // Status & review
  isActive            Boolean       @default(true)
  lastReviewDate      DateTime?
  nextReviewDate      DateTime?
  approvedBy          String?
  approvedAt          DateTime?
  
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  
  @@index([department])
  @@index([isActive])
}

// Data Protection Impact Assessment (DPIA)
model DPIA {
  id                  String        @id @default(uuid())
  
  // Assessment info
  title               String
  description         String        @db.Text
  featureOrSystem     String        // e.g., "SafetyScore", "AI Recommendations"
  
  // Risk assessment
  dataCategories      DataCategory[]
  processingOperations String[]
  
  // Necessity & proportionality
  necessity           String        @db.Text
  proportionality     String        @db.Text
  
  // Risks identified
  risks               Json          // Array of {description, likelihood, impact, score}
  
  // Mitigation measures
  mitigations         Json          // Array of {risk, measure, status, owner}
  
  // Residual risk
  residualRiskLevel   String        // LOW, MEDIUM, HIGH
  residualRiskAccepted Boolean      @default(false)
  
  // Consultation
  dpoConsulted        Boolean       @default(false)
  dpoComments         String?       @db.Text
  regulatorConsulted  Boolean       @default(false)
  regulatorResponse   String?       @db.Text
  
  // Approval
  status              String        @default("DRAFT") // DRAFT, PENDING_REVIEW, APPROVED, REJECTED
  approvedBy          String?
  approvedAt          DateTime?
  
  // Review schedule
  nextReviewDate      DateTime?
  
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  
  @@index([status])
  @@index([featureOrSystem])
}

// Data Breach Register
model DataBreach {
  id                  String        @id @default(uuid())
  
  // Breach identification
  title               String
  description         String        @db.Text
  detectedAt          DateTime
  detectedBy          String        // User ID or system
  
  // Classification
  severity            BreachSeverity
  status              BreachStatus  @default(DETECTED)
  
  // Affected data
  dataCategories      DataCategory[]
  affectedRecords     Int?          // Number of records affected
  affectedUsers       Int?          // Number of users affected
  
  // Impact assessment
  riskToIndividuals   String        @db.Text
  likelyConsequences  String?       @db.Text
  
  // Timeline
  occurredAt          DateTime?     // When breach actually occurred
  containedAt         DateTime?
  resolvedAt          DateTime?
  
  // Notification (72-hour requirement)
  notificationRequired Boolean      @default(false)
  regulatorNotifiedAt DateTime?
  regulatorReference  String?       // ICO/DPA reference number
  usersNotifiedAt     DateTime?
  notificationMethod  String?       // Email, letter, etc.
  
  // Response actions
  containmentActions  String[]
  remediationActions  String[]
  preventionMeasures  String[]
  
  // Root cause
  rootCause           String?       @db.Text
  
  // Lessons learned
  lessonsLearned      String?       @db.Text
  
  // Audit trail
  handledBy           String[]      // User IDs involved
  
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  
  @@index([severity])
  @@index([status])
  @@index([detectedAt])
}

// Subprocessor Registry
model Subprocessor {
  id                  String        @id @default(uuid())
  
  name                String
  description         String?
  
  // Contact
  contactName         String?
  contactEmail        String?
  
  // Location & transfers
  country             String
  isEUAdequate        Boolean       @default(false)
  transferMechanism   String?       // SCCs, adequacy, BCRs
  
  // Services provided
  services            String[]
  dataCategories      DataCategory[]
  
  // Compliance
  dpaSignedAt         DateTime?
  dpaExpiresAt        DateTime?
  sccVersion          String?       // SCC version if applicable
  
  // Security assessment
  lastAuditDate       DateTime?
  nextAuditDate       DateTime?
  securityCertifications String[]   // ISO 27001, SOC 2, etc.
  
  // Status
  isActive            Boolean       @default(true)
  
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  
  @@index([isActive])
  @@index([country])
}

// Data Retention Policy
model RetentionPolicy {
  id                  String        @id @default(uuid())
  
  dataType            String        @unique // e.g., "user_messages", "audit_logs"
  description         String
  
  dataCategory        DataCategory
  
  // Retention period
  retentionDays       Int           // Number of days to retain
  retentionReason     String
  legalBasis          LegalBasis
  
  // Deletion rules
  softDeleteFirst     Boolean       @default(true)
  hardDeleteAfterDays Int?          // Days after soft delete
  anonymizeInstead    Boolean       @default(false)
  
  // Legal hold
  canBeLegalHeld      Boolean       @default(true)
  
  // Automation
  automatedPurge      Boolean       @default(true)
  purgeJobName        String?
  lastPurgeAt         DateTime?
  nextPurgeAt         DateTime?
  
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  
  @@index([dataCategory])
}

// Legal Hold (suspends deletion)
model LegalHold {
  id                  String        @id @default(uuid())
  
  // Hold details
  name                String
  reason              String        @db.Text
  caseReference       String?
  
  // Scope
  affectedUserIds     String[]
  affectedDataTypes   String[]
  
  // Timeline
  startDate           DateTime      @default(now())
  endDate             DateTime?
  isActive            Boolean       @default(true)
  
  // Authorization
  authorizedBy        String        // Admin user ID
  authorizedAt        DateTime      @default(now())
  
  // Release
  releasedBy          String?
  releasedAt          DateTime?
  releaseReason       String?
  
  createdAt           DateTime      @default(now())
  updatedAt           DateTime      @updatedAt
  
  @@index([isActive])
}

// Privacy Audit Log (enhanced audit for GDPR)
model PrivacyAuditLog {
  id              String        @id @default(uuid())
  
  // Actor
  userId          String?       // User who performed action (null for system)
  adminId         String?       // Admin if admin action
  systemProcess   String?       // System process name if automated
  
  // Action
  action          String        // e.g., "DSAR_EXPORT", "CONSENT_CHANGE", "DATA_ACCESS"
  resourceType    String        // e.g., "User", "ConsentRecord", "DSARRequest"
  resourceId      String?
  
  // Details
  details         Json?         // Additional context
  previousValue   Json?         // Before state
  newValue        Json?         // After state
  
  // Request context
  ipAddress       String?
  userAgent       String?
  region          String?
  
  // Compliance
  legalBasis      String?
  retentionDays   Int           @default(2555) // ~7 years for compliance
  
  createdAt       DateTime      @default(now())
  
  @@index([userId])
  @@index([adminId])
  @@index([action])
  @@index([resourceType])
  @@index([createdAt])
}

// Cookie Consent (separate for granular cookie management)
model CookieConsent {
  id              String        @id @default(uuid())
  
  // Identifier (can be anonymous before login)
visitorId       String        @unique // Cookie ID or user ID
  userId          String?       // Linked user if logged in
  
  // Consent state
  essential       Boolean       @default(true)  // Always true, can't be disabled
  analytics       Boolean       @default(false)
  marketing       Boolean       @default(false)
  functional      Boolean       @default(false)
  
  // Context
  ipAddress       String?
  region          String?
  
  // Timestamps
  consentedAt     DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  expiresAt       DateTime      // Usually 1 year
  
  @@index([visitorId])
  @@index([userId])
  @@index([region])
}

// ===========================================
// ACCOUNTING, TAX, INVENTORY, MONEY
// ===========================================

model AccountingAccount {
  id              String                @id @default(uuid())
  organizationId  String?
  userId          String?

  name            String
  code            String?
  type            AccountingAccountType
  currency        String                @default("AUD")
  isActive        Boolean               @default(true)

  organization    Organization?         @relation(fields: [organizationId], references: [id])
  user            User?                 @relation(fields: [userId], references: [id])
  journalLines    JournalLine[]

  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt

  @@index([organizationId])
  @@index([userId])
  @@index([type])
  @@index([currency])
  @@index([isActive])
  @@unique([organizationId, code])
}

model JournalEntry {
  id              String                @id @default(uuid())
  organizationId  String?
  userId          String?

  description     String
  reference       String?
  status          JournalEntryStatus    @default(DRAFT)
  entryDate       DateTime              @default(now())
  postedAt        DateTime?
  metadata        Json?

  organization    Organization?         @relation(fields: [organizationId], references: [id])
  user            User?                 @relation(fields: [userId], references: [id])
  lines           JournalLine[]

  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt

  @@index([organizationId])
  @@index([userId])
  @@index([status])
  @@index([status, entryDate])
  @@index([entryDate])
}

model JournalLine {
  id              String        @id @default(uuid())
  journalEntryId  String
  accountId       String

  debit           Decimal       @default(0)
  credit          Decimal       @default(0)
  description     String?

  journalEntry    JournalEntry  @relation(fields: [journalEntryId], references: [id], onDelete: Cascade)
  account         AccountingAccount @relation(fields: [accountId], references: [id])

  createdAt       DateTime      @default(now())

  @@index([journalEntryId])
  @@index([accountId])
}

model TaxRate {
  id              String        @id @default(uuid())
  organizationId  String?
  name            String
  type            TaxRateType
  rate            Decimal
  region          Region?
  isActive        Boolean       @default(true)
  effectiveFrom   DateTime      @default(now())
  effectiveTo     DateTime?

  organization    Organization? @relation(fields: [organizationId], references: [id])

  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([organizationId])
  @@index([region])
  @@index([type])
  @@index([isActive])
  @@index([organizationId, type])
}

model TaxReturn {
  id              String            @id @default(uuid())
  organizationId  String?
  userId          String?

  periodStart     DateTime
  periodEnd       DateTime
  status          TaxReturnStatus   @default(DRAFT)
  currency        String            @default("AUD")
  totalSales      Decimal           @default(0)
  totalTax        Decimal           @default(0)
  filedAt         DateTime?
  reference       String?
  metadata        Json?

  organization    Organization?     @relation(fields: [organizationId], references: [id])
  user            User?             @relation(fields: [userId], references: [id])

  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@index([organizationId])
  @@index([userId])
  @@index([status])
  @@index([periodStart, periodEnd])
  @@index([organizationId, status])
}

model InventoryItem {
  id              String                  @id @default(uuid())
  organizationId  String?

  sku             String
  name            String
  description     String?
  unit            String                 @default("unit")
  valuationMethod InventoryValuationMethod @default(FIFO)
  currency        String                 @default("AUD")
  cost            Decimal                @default(0)
  price           Decimal                @default(0)
  isActive        Boolean                @default(true)

  organization    Organization?          @relation(fields: [organizationId], references: [id])
  transactions    InventoryTransaction[]

  createdAt       DateTime               @default(now())
  updatedAt       DateTime               @updatedAt

  @@index([organizationId])
  @@index([isActive])
  @@index([organizationId, sku])
  @@unique([organizationId, sku])
}

model InventoryLocation {
  id              String        @id @default(uuid())
  organizationId  String?
  name            String
  code            String
  address         String?
  isActive        Boolean       @default(true)

  organization    Organization? @relation(fields: [organizationId], references: [id])
  transactions    InventoryTransaction[]

  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([organizationId])
  @@index([isActive])
  @@index([organizationId, code])
  @@unique([organizationId, code])
}

model InventoryTransaction {
  id              String                  @id @default(uuid())
  itemId          String
  locationId      String?
  createdByUserId String?

  type            InventoryTransactionType
  quantity        Decimal
  unitCost        Decimal?
  totalCost       Decimal?
  reference       String?
  occurredAt      DateTime                @default(now())

  item            InventoryItem           @relation(fields: [itemId], references: [id], onDelete: Cascade)
  location        InventoryLocation?      @relation(fields: [locationId], references: [id])
  createdBy       User?                   @relation("InventoryTransactionsCreated", fields: [createdByUserId], references: [id])

  createdAt       DateTime                @default(now())

  @@index([itemId])
  @@index([locationId])
  @@index([type])
  @@index([occurredAt])
  @@index([itemId, occurredAt])
}

model MoneyTransaction {
  id              String                @id @default(uuid())
  organizationId  String?
  userId          String?

  amount          Decimal
  currency        String                @default("AUD")
  type            MoneyTransactionType
  status          MoneyTransactionStatus @default(PENDING)
  provider        String?
  reference       String?
  metadata        Json?

  organization    Organization?         @relation(fields: [organizationId], references: [id])
  user            User?                 @relation(fields: [userId], references: [id])

  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt

  @@index([organizationId])
  @@index([userId])
  @@index([status])
  @@index([type])
  @@index([currency])
}

// ===========================================
// PHASE 9: BUSINESS TRANSFORMATION MODELS
// ===========================================

model AcceleratorCohort {
  id              String                    @id @default(uuid())
  name            String
  description     String?
  startDate       DateTime
  endDate         DateTime
  maxParticipants Int                       @default(30)
  priceAud        Decimal                   @default(2500)
  status          AcceleratorCohortStatus   @default(UPCOMING)
  curriculum      Json?
  mentorIds       String[]

  enrollments     AcceleratorEnrollment[]
  sessions        AcceleratorSession[]

  createdAt       DateTime                  @default(now())
  updatedAt       DateTime                  @updatedAt

  @@index([status])
  @@index([startDate])
}

model AcceleratorEnrollment {
  id              String                        @id @default(uuid())
  cohortId        String
  userId          String
  status          AcceleratorEnrollmentStatus   @default(PENDING)
  paymentStatus   PaymentStatus                 @default(PENDING)
  paymentId       String?
  completedWeeks  Int                           @default(0)
  deliverables    Json?
  mentorNotes     Json?
  enrolledAt      DateTime                      @default(now())
  completedAt     DateTime?

  cohort          AcceleratorCohort             @relation(fields: [cohortId], references: [id])
  user            User                          @relation(fields: [userId], references: [id])

  @@unique([cohortId, userId])
  @@index([userId])
  @@index([status])
}

model AcceleratorSession {
  id            String              @id @default(uuid())
  cohortId      String
  weekNumber    Int
  title         String
  description   String?
  scheduledAt   DateTime
  durationMins  Int                 @default(120)
  meetingUrl    String?
  recordingUrl  String?
  materials     Json?

  cohort        AcceleratorCohort   @relation(fields: [cohortId], references: [id])

  createdAt     DateTime            @default(now())

  @@index([cohortId])
  @@index([weekNumber])
}

model Grant {
  id              String              @id @default(uuid())
  name            String
  description     String
  provider        String
  providerType    GrantProviderType
  minFunding      Decimal?
  maxFunding      Decimal?
  industries      String[]
  stages          String[]
  regions         String[]
  requirements    Json?
  applicationUrl  String?
  deadline        DateTime?
  isRolling       Boolean             @default(false)
  tags            String[]
  isActive        Boolean             @default(true)

  applications    GrantApplication[]

  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  @@index([providerType])
  @@index([isActive])
  @@index([deadline])
}

model GrantApplication {
  id              String                  @id @default(uuid())
  grantId         String
  userId          String
  status          GrantApplicationStatus  @default(DRAFT)
  matchScore      Int?
  applicationData Json?
  submittedAt     DateTime?
  resultAt        DateTime?
  amountAwarded   Decimal?
  notes           String?

  grant           Grant                   @relation(fields: [grantId], references: [id])
  user            User                    @relation(fields: [userId], references: [id])

  createdAt       DateTime                @default(now())
  updatedAt       DateTime                @updatedAt

  @@unique([grantId, userId])
  @@index([userId])
  @@index([status])
}

model Investor {
  id                  String          @id @default(uuid())
  name                String
  type                InvestorType
  description         String?
  minCheckSize        Decimal?
  maxCheckSize        Decimal?
  stages              String[]
  industries          String[]
  regions             String[]
  thesis              String?
  website             String?
  linkedinUrl         String?
  portfolioCompanies  Json?
  isActive            Boolean         @default(true)
  isVerified          Boolean         @default(false)

  introductions       InvestorIntroduction[]

  createdAt           DateTime        @default(now())
  updatedAt           DateTime        @updatedAt

  @@index([type])
  @@index([isActive])
}

model InvestorIntroduction {
  id            String              @id @default(uuid())
  investorId    String
  userId        String
  status        IntroductionStatus  @default(REQUESTED)
  message       String?
  requestedAt   DateTime            @default(now())
  introducedAt  DateTime?
  respondedAt   DateTime?
  outcome       String?

  investor      Investor            @relation(fields: [investorId], references: [id])
  user          User                @relation(fields: [userId], references: [id])

  @@unique([investorId, userId])
  @@index([userId])
  @@index([status])
}

model Vendor {
  id            String          @id @default(uuid())
  name          String
  category      VendorCategory
  description   String?
  services      String[]
  priceRange    String?
  discountPct   Int?
  website       String?
  email         String?
  phone         String?
  location      String?
  isVerified    Boolean         @default(false)
  isPartner     Boolean         @default(false)
  avgRating     Decimal?        @default(0)
  reviewCount   Int             @default(0)

  reviews       VendorReview[]
  rfpResponses  RfpResponse[]

  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  @@index([category])
  @@index([isPartner])
  @@index([avgRating])
}

model VendorReview {
  id          String    @id @default(uuid())
  vendorId    String
  userId      String
  rating      Int
  title       String?
  content     String?
  projectType String?
  isVerified  Boolean   @default(false)

  vendor      Vendor    @relation(fields: [vendorId], references: [id])
  user        User      @relation(fields: [userId], references: [id])

  createdAt   DateTime  @default(now())

  @@unique([vendorId, userId])
  @@index([vendorId])
  @@index([rating])
}

model Rfp {
  id            String          @id @default(uuid())
  userId        String
  title         String
  description   String
  category      VendorCategory
  budget        String?
  deadline      DateTime?
  requirements  Json?
  status        RfpStatus       @default(OPEN)

  user          User            @relation(fields: [userId], references: [id])
  responses     RfpResponse[]

  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  @@index([userId])
  @@index([status])
  @@index([category])
}

model RfpResponse {
  id          String            @id @default(uuid())
  rfpId       String
  vendorId    String
  proposal    String
  priceQuote  Decimal?
  timeline    String?
  attachments Json?
  status      RfpResponseStatus @default(SUBMITTED)
  isSelected  Boolean           @default(false)

  rfp         Rfp               @relation(fields: [rfpId], references: [id])
  vendor      Vendor            @relation(fields: [vendorId], references: [id])

  createdAt   DateTime          @default(now())

  @@unique([rfpId, vendorId])
  @@index([rfpId])
  @@index([vendorId])
}

// ===========================================
// PHASE 10: HOUSING & FINANCIAL SECURITY MODELS
// ===========================================

model HousingListing {
  id              String                @id @default(uuid())
  agentId         String?
  title           String
  description     String
  type            HousingListingType
  address         String?
  suburb          String?
  city            String?
  state           String?
  postcode        String?
  country         String                @default("Australia")
  rentWeekly      Decimal?
  bondAmount      Decimal?
  bedrooms        Int?
  bathrooms       Int?
  parking         Int?
  features        String[]
  safetyVerified  Boolean               @default(false)
  dvSafe          Boolean               @default(false)
  petFriendly     Boolean               @default(false)
  accessibleUnit  Boolean               @default(false)
  availableFrom   DateTime?
  minLeaseTerm    Int?
  flexibleLease   Boolean               @default(false)
  images          Json?
  status          HousingListingStatus  @default(ACTIVE)

  inquiries       HousingInquiry[]

  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt

  @@index([type])
  @@index([status])
  @@index([dvSafe])
  @@index([city])
}

model HousingInquiry {
  id            String                @id @default(uuid())
  listingId     String
  userId        String
  message       String?
  status        HousingInquiryStatus  @default(PENDING)
  viewingDate   DateTime?
  notes         String?

  listing       HousingListing        @relation(fields: [listingId], references: [id])
  user          User                  @relation(fields: [userId], references: [id])

  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt

  @@unique([listingId, userId])
  @@index([userId])
  @@index([status])
}

model SavingsGoal {
  id              String              @id @default(uuid())
  userId          String
  name            String
  type            SavingsGoalType
  targetAmount    Decimal
  currentAmount   Decimal             @default(0)
  currency        String              @default("AUD")
  targetDate      DateTime?
  monthlyTarget   Decimal?
  autoSaveEnabled Boolean             @default(false)
  autoSaveAmount  Decimal?
  status          SavingsGoalStatus   @default(ACTIVE)

  contributions   SavingsContribution[]
  user            User                @relation(fields: [userId], references: [id])

  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt

  @@index([userId])
  @@index([type])
  @@index([status])
}

model SavingsContribution {
  id            String        @id @default(uuid())
  goalId        String
  amount        Decimal
  currency      String        @default("AUD")
  source        String?
  note          String?

  goal          SavingsGoal   @relation(fields: [goalId], references: [id])

  createdAt     DateTime      @default(now())

  @@index([goalId])
}

model InsuranceProduct {
  id                String          @id @default(uuid())
  provider          String
  name              String
  type              InsuranceType
  description       String?
  coverageAmount    Decimal?
  premiumMonthly    Decimal?
  premiumAnnual     Decimal?
  waitingPeriod     Int?
  benefitPeriod     Int?
  features          String[]
  exclusions        String[]
  commissionPct     Decimal?
  isActive          Boolean         @default(true)

  applications      InsuranceApplication[]

  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  @@index([type])
  @@index([isActive])
}

model InsuranceApplication {
  id              String                      @id @default(uuid())
  productId       String
  userId          String
  status          InsuranceApplicationStatus  @default(DRAFT)
  applicationData Json?
  premiumQuoted   Decimal?
  coverageAmount  Decimal?
  submittedAt     DateTime?
  approvedAt      DateTime?
  policyNumber    String?
  startDate       DateTime?
  endDate         DateTime?

  product         InsuranceProduct            @relation(fields: [productId], references: [id])
  user            User                        @relation(fields: [userId], references: [id])

  createdAt       DateTime                    @default(now())
  updatedAt       DateTime                    @updatedAt

  @@unique([productId, userId])
  @@index([userId])
  @@index([status])
}

model SuperannuationAccount {
  id              String    @id @default(uuid())
  userId          String
  fundName        String
  memberNumber    String?
  balance         Decimal   @default(0)
  currency        String    @default("AUD")
  employerContr   Decimal?
  personalContr   Decimal?
  investmentOpt   String?
  insuranceInc    Boolean   @default(false)
  lastSyncAt      DateTime?

  user            User      @relation(fields: [userId], references: [id])

  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([userId])
}

model FinancialHealthScore {
  id                  String    @id @default(uuid())
  userId              String    @unique
  overallScore        Int
  emergencyFundScore  Int?
  debtScore           Int?
  savingsRateScore    Int?
  insuranceScore      Int?
  superScore          Int?
  recommendations     Json?
  calculatedAt        DateTime  @default(now())

  user                User      @relation(fields: [userId], references: [id])

  @@index([overallScore])
}

// ===========================================
// PHASE 11: SOCIAL IMPACT & SCALE
// ===========================================

enum CommunityType {
  FIRST_NATIONS
  REFUGEE_IMMIGRANT
  DV_SURVIVOR
  DISABILITY
  LGBTQIA
  SINGLE_PARENT
  RURAL_REGIONAL
  GENERAL
}

enum SupportProgramStatus {
  ACTIVE
  COMPLETED
  PAUSED
  CANCELLED
}

enum ImpactMetricType {
  EMPLOYMENT_GAINED
  INCOME_INCREASED
  HOUSING_SECURED
  QUALIFICATION_OBTAINED
  BUSINESS_STARTED
  SAFETY_ACHIEVED
  SKILL_CERTIFIED
  MENTORSHIP_COMPLETED
  FINANCIAL_INDEPENDENCE
}

enum LanguageProficiency {
  NATIVE
  FLUENT
  ADVANCED
  INTERMEDIATE
  BEGINNER
  NONE
}

enum CredentialStatus {
  PENDING_REVIEW
  RECOGNIZED
  PARTIALLY_RECOGNIZED
  BRIDGING_REQUIRED
  NOT_RECOGNIZED
}

// Community Support Program - Tailored programs for marginalized communities
model CommunitySupportProgram {
  id                  String              @id @default(uuid())
  name                String
  communityType       CommunityType
  description         String
  eligibilityDesc     String?
  objectives          String[]
  partnerOrgs         String[]
  fundingSource       String?
  maxParticipants     Int?
  currentParticipants Int                 @default(0)
  startDate           DateTime?
  endDate             DateTime?
  isActive            Boolean             @default(true)
  region              Region              @default(ANZ)

  enrollments         ProgramEnrollment[]
  milestones          ProgramMilestone[]

  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt

  @@index([communityType])
  @@index([isActive])
  @@index([region])
}

model ProgramEnrollment {
  id              String                @id @default(uuid())
  programId       String
  userId          String
  status          SupportProgramStatus  @default(ACTIVE)
  enrolledAt      DateTime              @default(now())
  completedAt     DateTime?
  caseManagerId   String?
  notes           String?
  goalsSet        Json?
  progressData    Json?

  program         CommunitySupportProgram @relation(fields: [programId], references: [id])
  user            User                    @relation(fields: [userId], references: [id])
  milestoneProgress MilestoneProgress[]

  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt

  @@unique([programId, userId])
  @@index([userId])
  @@index([status])
}

model ProgramMilestone {
  id              String                @id @default(uuid())
  programId       String
  title           String
  description     String?
  orderIndex      Int                   @default(0)
  requiredForCompletion Boolean         @default(false)

  program         CommunitySupportProgram @relation(fields: [programId], references: [id])
  progress        MilestoneProgress[]

  createdAt       DateTime              @default(now())

  @@index([programId])
}

model MilestoneProgress {
  id              String            @id @default(uuid())
  enrollmentId    String
  milestoneId     String
  isCompleted     Boolean           @default(false)
  completedAt     DateTime?
  evidence        String?
  verifiedBy      String?

  enrollment      ProgramEnrollment @relation(fields: [enrollmentId], references: [id])
  milestone       ProgramMilestone  @relation(fields: [milestoneId], references: [id])

  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@unique([enrollmentId, milestoneId])
}

// First Nations / Indigenous Women Support
model IndigenousCommunityPage {
  id                String    @id @default(uuid())
  name              String
  description       String?
  region            String?
  nation            String?   // Traditional owner group
  isWomenOnly       Boolean   @default(true)
  coverImage        String?
  membersCount      Int       @default(0)
  isVerified        Boolean   @default(false)
  moderatorIds      String[]
  culturalProtocols String?

  members           IndigenousCommunityMember[]
  resources         IndigenousResource[]

  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  @@index([isWomenOnly])
  @@index([isVerified])
}

model IndigenousCommunityMember {
  id              String                  @id @default(uuid())
  communityId     String
  userId          String
  role            String                  @default("MEMBER") // MEMBER, ELDER, MODERATOR
  joinedAt        DateTime                @default(now())

  community       IndigenousCommunityPage @relation(fields: [communityId], references: [id])
  user            User                    @relation(fields: [userId], references: [id])

  @@unique([communityId, userId])
  @@index([userId])
}

model IndigenousResource {
  id              String                  @id @default(uuid())
  communityId     String?
  title           String
  description     String?
  type            String                  // FUNDING, MENTORSHIP, JOB_BOARD, TRAINING, CULTURAL
  url             String?
  partnerOrg      String?
  isNational      Boolean                 @default(false)

  community       IndigenousCommunityPage? @relation(fields: [communityId], references: [id])

  createdAt       DateTime                @default(now())

  @@index([type])
  @@index([isNational])
}

// Refugee & Immigrant Integration
model LanguageProfile {
  id                  String              @id @default(uuid())
  userId              String              @unique
  primaryLanguage     String
  primaryProficiency  LanguageProficiency @default(NATIVE)
  englishProficiency  LanguageProficiency @default(INTERMEDIATE)
  otherLanguages      Json?               // Array of { language, proficiency }
  needsInterpreter    Boolean             @default(false)
  preferredInterpreterLang String?

  user                User                @relation(fields: [userId], references: [id])

  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
}

model InternationalCredential {
  id                  String            @id @default(uuid())
  userId              String
  originalCountry     String
  credentialType      String            // DEGREE, DIPLOMA, CERTIFICATE, LICENSE
  credentialName      String
  institution         String
  yearObtained        Int?
  fieldOfStudy        String?
  documentUrl         String?
  status              CredentialStatus  @default(PENDING_REVIEW)
  australianEquiv     String?           // Mapped AU equivalent
  bridgingRequired    String?           // Required bridging course
  assessmentBody      String?           // e.g., VETASSESS, AEI-NOOSR
  assessmentDate      DateTime?
  notes               String?

  user                User              @relation(fields: [userId], references: [id])

  createdAt           DateTime          @default(now())
  updatedAt           DateTime          @updatedAt

  @@index([userId])
  @@index([status])
  @@index([originalCountry])
}

model BridgingProgram {
  id                String    @id @default(uuid())
  name              String
  provider          String
  profession        String    // nursing, engineering, accounting, etc.
  description       String?
  duration          String?
  cost              Decimal?
  fundingAvailable  Boolean   @default(false)
  url               String?
  requirements      String[]
  outcomes          String[]
  region            Region    @default(ANZ)
  isActive          Boolean   @default(true)

  enrollments       BridgingEnrollment[]

  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  @@index([profession])
  @@index([isActive])
}

model BridgingEnrollment {
  id              String            @id @default(uuid())
  programId       String
  userId          String
  credentialId    String?           // Link to credential being bridged
  status          SupportProgramStatus @default(ACTIVE)
  enrolledAt      DateTime          @default(now())
  completedAt     DateTime?
  progressPct     Int               @default(0)

  program         BridgingProgram   @relation(fields: [programId], references: [id])
  user            User              @relation(fields: [userId], references: [id])

  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@unique([programId, userId])
  @@index([userId])
  @@index([status])
}

// DV Survivor Support
model SafetyPlan {
  id                String    @id @default(uuid())
  userId            String    @unique
  emergencyContacts Json?     // Encrypted
  safeLocations     Json?     // Encrypted
  warningTriggers   Json?     // Encrypted
  exitStrategies    Json?     // Encrypted
  importantDocs     Json?     // List of important documents to secure
  financialPlan     Json?     // Steps to financial independence
  legalContacts     Json?     // Lawyers, police contacts
  lastReviewedAt    DateTime?
  isActive          Boolean   @default(true)

  user              User      @relation(fields: [userId], references: [id])

  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}

model DVSupportService {
  id                String    @id @default(uuid())
  name              String
  type              String    // CRISIS, LEGAL, FINANCIAL, HOUSING, COUNSELING, CHILDREN
  phone             String?
  website           String?
  description       String?
  available24x7     Boolean   @default(false)
  state             String?
  isNational        Boolean   @default(false)

  createdAt         DateTime  @default(now())

  @@index([type])
  @@index([state])
  @@index([isNational])
}

// Disability Support
model AccessibilityProfile {
  id                    String    @id @default(uuid())
  userId                String    @unique
  hasVisionImpairment   Boolean   @default(false)
  hasHearingImpairment  Boolean   @default(false)
  hasMobilityImpairment Boolean   @default(false)
  hasCognitiveDisability Boolean  @default(false)
  usesScreenReader      Boolean   @default(false)
  usesVoiceControl      Boolean   @default(false)
  preferredFontSize     String?   // small, medium, large, extra-large
  highContrastMode      Boolean   @default(false)
  reducedMotion         Boolean   @default(false)
  captionsRequired      Boolean   @default(false)
  otherNeeds            String?
  workAccommodations    String[]  // Specific workplace accommodations needed

  user                  User      @relation(fields: [userId], references: [id])

  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
}

model DisabilityFriendlyEmployer {
  id                  String    @id @default(uuid())
  organizationId      String    @unique
  accessibilityRating Int?      // 1-5
  accommodationsOffered String[]
  hasWheelchairAccess Boolean   @default(false)
  hasFlexibleWork     Boolean   @default(false)
  hasRemoteOptions    Boolean   @default(false)
  hasMentalHealthSupport Boolean @default(false)
  verifiedAt          DateTime?
  badgeType           String?   // DISABILITY_CONFIDENT, ACCESSIBILITY_CHAMPION

  organization        Organization @relation(fields: [organizationId], references: [id])

  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
}

// Social Impact Metrics & Tracking
model ImpactMetric {
  id              String            @id @default(uuid())
  userId          String
  metricType      ImpactMetricType
  value           Decimal?
  description     String?
  evidenceUrl     String?
  verifiedAt      DateTime?
  verifiedBy      String?
  communityType   CommunityType?
  programId       String?

  user            User              @relation(fields: [userId], references: [id])

  createdAt       DateTime          @default(now())

  @@index([userId])
  @@index([metricType])
  @@index([communityType])
}

model ImpactReport {
  id                      String    @id @default(uuid())
  reportPeriod            String    // Q1-2026, FY2026, etc.
  communityType           CommunityType?
  region                  Region    @default(ANZ)
  totalUsersSupported     Int       @default(0)
  employmentGained        Int       @default(0)
  avgIncomeIncrease       Decimal?
  housingSecured          Int       @default(0)
  qualificationsObtained  Int       @default(0)
  businessesStarted       Int       @default(0)
  safetyAchieved          Int       @default(0)
  totalEconomicImpact     Decimal?
  narrativeSummary        String?
  dataJson                Json?

  createdAt               DateTime  @default(now())

  @@unique([reportPeriod, communityType, region])
  @@index([communityType])
  @@index([region])
}

// Partner Organizations for Impact Programs
model ImpactPartner {
  id              String    @id @default(uuid())
  name            String
  type            String    // GOVERNMENT, NGO, CORPORATE, COMMUNITY
  focusAreas      CommunityType[]
  website         String?
  contactEmail    String?
  contactPhone    String?
  description     String?
  logoUrl         String?
  partnerSince    DateTime?
  isActive        Boolean   @default(true)
  region          Region    @default(ANZ)

  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([isActive])
}

// ===========================================
// PHASE 12: SUPER APP - AI ALGORITHMS
// ===========================================

enum VideoCategory {
  CAREER_TRANSFORMATION
  SKILL_SHOWCASE
  DAY_IN_THE_LIFE
  MENTORSHIP_MOMENT
  SUCCESS_CELEBRATION
  FINANCIAL_LITERACY
  ENTREPRENEURSHIP
  LEADERSHIP
  TECH
  WELLNESS
  EDUCATION
  GENERAL
}

// CareerCompass Predictions
model CareerPrediction {
  id                String    @id @default(uuid())
  userId            String
  
  // Predicted next roles
  predictedRoles    Json      // [{role, probability, expectedSalary, timeline, skillsGap}]
  prioritySkills    Json      // [{skill, salaryLift, learningTime, difficulty}]
  mentorRecommendations Json? // [{mentorId, compatibility, reason}]
  opportunitiesToTrack Json?  // [{type, id, matchScore}]
  riskFactors       Json?     // {attritionRisk, burnoutIndicators, wageGapExposure}
  
  // Model metadata
  modelVersion      String
  confidenceScore   Float     // 0-1
  
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  generatedAt       DateTime  @default(now())
  expiresAt         DateTime  // Predictions valid for ~30 days
  
  @@index([userId])
  @@index([generatedAt])
}

// OpportunityScan Results
model OpportunityMatch {
  id              String    @id @default(uuid())
  userId          String
  
  // Opportunity details
  opportunityType String    // JOB, MENTORSHIP, GRANT, SPEAKING, INVESTOR, FREELANCE, PARTNERSHIP, BOARD
  referenceId     String    // ID of the matched entity
  referenceType   String    // Job, User (mentor), Grant, etc.
  
  // Scoring
  matchScore      Int       // 0-100
  skillsMatch     Int       // 0-100
  salaryFit       Int?      // 0-100
  growthPotential Int?      // 0-100
  cultureFit      Int?      // 0-100
  
  // Explanation
  matchReasons    Json      // [{reason, weight}]
  
  // User interaction
  isViewed        Boolean   @default(false)
  viewedAt        DateTime?
  isInterested    Boolean?
  interactionAt   DateTime?
  feedback        String?   // NOT_RELEVANT, APPLIED, SAVED, etc.
  
  // Delivery
  deliveredAt     DateTime?
  notificationSent Boolean  @default(false)
  
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  createdAt       DateTime  @default(now())
  expiresAt       DateTime?
  
  @@index([userId, isViewed])
  @@index([opportunityType])
  @@index([matchScore])
}

// SalaryEquity Data & Analysis
model SalaryDataPoint {
  id              String    @id @default(uuid())
  userId          String?   // Optional, for anonymous submissions
  
  // Role details
  jobTitle        String
  normalizedTitle String?   // Standardized title
  company         String?
  companySize     String?   // 1-10, 11-50, 51-200, 201-500, 500+
  industry        String?
  
  // Location
  city            String?
  state           String?
  country         String    @default("Australia")
  isRemote        Boolean   @default(false)
  
  // Compensation
  baseSalary      Decimal
  currency        String    @default("AUD")
  bonus           Decimal?
  equity          Decimal?
  totalComp       Decimal?
  
  // Experience
  yearsExperience Int?
  yearsInRole     Int?
  educationLevel  String?   // HIGH_SCHOOL, BACHELOR, MASTER, PHD, OTHER
  
  // Demographics (anonymous, optional)
  gender          String?   // WOMAN, MAN, NON_BINARY, PREFER_NOT
  ageRange        String?   // 18-24, 25-34, 35-44, 45-54, 55+
  
  // Verification
  isVerified      Boolean   @default(false)
  verificationMethod String? // PAY_STUB, OFFER_LETTER, TAX_RETURN
  
  user            User?     @relation(fields: [userId], references: [id])
  
  submittedAt     DateTime  @default(now())
  
  @@index([normalizedTitle])
  @@index([city, state])
  @@index([gender])
  @@index([submittedAt])
}

model SalaryAnalysis {
  id                String    @id @default(uuid())
  userId            String
  
  // Query parameters
  targetRole        String
  targetLocation    String?
  targetCompany     String?
  
  // Analysis results
  marketMedian      Decimal
  userPercentile    Int?      // Where user falls (1-100)
  genderGapAmount   Decimal?
  genderGapPercent  Float?
  sampleSize        Int
  
  // Detailed breakdown
  salaryBands       Json      // {p10, p25, p50, p75, p90}
  byExperience      Json?     // {0-2: median, 3-5: median, ...}
  byEducation       Json?     // {BACHELOR: median, MASTER: median, ...}
  byCompanySize     Json?
  
  // Negotiation support
  negotiationTips   Json?     // [{tip, priority}]
  comparableOffers  Json?     // Similar roles for leverage
  
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  generatedAt       DateTime  @default(now())
  
  @@index([userId])
  @@index([targetRole])
}

// MentorMatch Compatibility
model MentorMatchScore {
  id                String    @id @default(uuid())
  menteeId          String
  mentorId          String
  
  // Compatibility scores
  overallScore      Int       // 0-100
  careerPathSimilarity Int    // 0-100
  skillGapCoverage  Int       // 0-100
  industryKnowledge Int       // 0-100
  styleCompatibility Int      // 0-100
  timezoneOverlap   Int       // 0-100
  availabilityMatch Int       // 0-100
  successLikelihood Int       // 0-100 (based on historical data)
  
  // Explanation
  matchReasons      Json      // [{reason, score}]
  recommendedFormat String?   // CAREER_MENTOR, SKILL_COACH, EXECUTIVE, etc.
  
  // Status
  isActive          Boolean   @default(true)
  
  mentee            User      @relation("MenteeMatches", fields: [menteeId], references: [id], onDelete: Cascade)
  mentor            User      @relation("MentorMatches", fields: [mentorId], references: [id], onDelete: Cascade)
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@unique([menteeId, mentorId])
  @@index([menteeId, overallScore])
  @@index([mentorId])
}

// SafetyScore - Trust & Verification
model UserTrustScore {
  id                String    @id @default(uuid())
  userId            String    @unique
  
  // Overall score
  trustScore        Int       @default(50) // 0-100
  
  // Component scores
  identityVerified  Boolean   @default(false)
  identityScore     Int       @default(0)  // +25 if verified
  accountAge        Int       @default(0)  // Days since creation
  accountAgeScore   Int       @default(0)  // Increases over time
  communityFeedback Int       @default(50) // Based on reports/praise
  engagementScore   Int       @default(50) // Real vs. bot patterns
  professionalScore Int       @default(0)  // Employer/education verification
  
  // Badges
  badges            String[]  // VERIFIED_IDENTITY, EMPLOYER_VERIFIED, EDUCATOR_VERIFIED, MENTOR_CERTIFIED, CREATOR_VERIFIED
  
  // Moderation history
  warningsCount     Int       @default(0)
  suspensionsCount  Int       @default(0)
  lastIncidentAt    DateTime?
  
  // Reports
  reportsAgainst    Int       @default(0)
  reportsSubmitted  Int       @default(0)
  reportAccuracy    Float?    // How often user's reports are valid
  
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  
  @@index([trustScore])
}

// Content Moderation
model ContentReport {
  id              String    @id @default(uuid())
  reporterId      String
  
  // Reported content
  contentType     String    // MESSAGE, VIDEO, COMMENT, PROFILE, STATUS
  contentId       String
  reportedUserId  String
  
  // Report details
  reason          String    // HARASSMENT, HATE_SPEECH, SPAM, MISINFORMATION, INAPPROPRIATE, OTHER
  description     String?
  evidence        Json?     // Screenshots, message IDs, etc.
  
  // Processing
  status          String    @default("PENDING") // PENDING, REVIEWING, RESOLVED, DISMISSED
  reviewerId      String?
  reviewNotes     String?
  action          String?   // WARNING, CONTENT_REMOVED, SUSPENSION, BAN, NO_ACTION
  actionTakenAt   DateTime?
  
  // AI pre-screening
  aiConfidence    Float?    // 0-1 confidence in violation
  aiCategory      String?   // Detected category
  
  reporter        User      @relation("ReportsSubmitted", fields: [reporterId], references: [id])
  reportedUser    User      @relation("ReportsReceived", fields: [reportedUserId], references: [id])
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@index([reportedUserId])
  @@index([status])
  @@index([contentType, contentId])
}

// IncomeStream Creator Analytics
model CreatorAnalytics {
  id                String    @id @default(uuid())
  userId            String    @unique
  
  // Follower metrics
  followerCount     Int       @default(0)
  followingCount    Int       @default(0)
  followerGrowth    Json?     // {daily: [], weekly: [], monthly: []}
  
  // Content metrics
  totalVideos       Int       @default(0)
  totalViews        Int       @default(0)
  avgViews          Float?
  totalLikes        Int       @default(0)
  avgEngagementRate Float?    // (likes + comments + shares) / views
  
  // Audience insights
  audienceGender    Json?     // {woman: 70, man: 25, other: 5}
  audienceAge       Json?     // {18-24: 30, 25-34: 45, ...}
  audienceLocation  Json?     // {AU: 60, NZ: 10, UK: 15, ...}
  peakActiveHours   Json?     // Best times to post
  
  // Revenue tracking
  totalEarnings     Decimal   @default(0)
  monthlyEarnings   Json?     // {2026-01: 500, 2026-02: 750, ...}
  revenueBySource   Json?     // {ads: 200, sponsorships: 1000, tips: 50, ...}
  
  // Tier & eligibility
  creatorTier       String    @default("BRONZE") // BRONZE, SILVER, GOLD, PLATINUM
  isMonetized       Boolean   @default(false)
  monetizedAt       DateTime?
  
  // Income projections (IncomeStream algorithm)
  projectedIncome   Json?     // {conservative, realistic, optimistic}
  topRevenueStreams Json?     // [{stream, potential, effort}]
  monetizationRoadmap Json?   // Phases to unlock streams
  
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}

// Video Feed Personalization (OpportunityVerse)
model UserFeedPreferences {
  id                String    @id @default(uuid())
  userId            String    @unique
  
  // Interest signals
  followedCategories VideoCategory[]
  followedHashtags  String[]
  blockedHashtags   String[]
  blockedCreators   String[]
  
  // Engagement history (for recommendations)
  likedCategories   Json?     // {TECH: 45, ENTREPRENEURSHIP: 30, ...}
  watchHistory      Json?     // Recent video IDs and watch times
  searchHistory     String[]  // Recent searches
  
  // Feed composition preferences
  inNetworkRatio    Float     @default(0.3)  // 30% from followed
  outNetworkRatio   Float     @default(0.5)  // 50% recommended
  trendingRatio     Float     @default(0.2)  // 20% trending
  
  // Content preferences
  preferredDuration String?   // SHORT (<30s), MEDIUM (30-60s), LONG (>60s)
  autoplayEnabled   Boolean   @default(true)
  
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
}

// Feature Flags
model FeatureFlag {
  id                String    @id @default(uuid())
  key               String    @unique
  name              String
  description       String?
  enabled           Boolean   @default(false)
  rolloutPercentage Int       @default(100) // 0-100
  allowList         String[]  // User IDs always enabled
  denyList          String[]  // User IDs always disabled
  tags              String[]
  metadata          Json?
  createdById       String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  @@index([enabled])
  @@index([key])
}

// ===========================================
// UK ONLINE SAFETY ACT COMPLIANCE
// Phase 4: UK/EU Market Launch
// ===========================================

// Moderation action log for transparency reporting
model ModerationLog {
  id              String    @id @default(uuid())
  ticketId        String
  action          String    // warn, remove, suspend, ban, dismiss, escalate
  moderatorId     String
  notes           String?
  timestamp       DateTime
  
  createdAt       DateTime  @default(now())
  
  @@index([ticketId])
  @@index([moderatorId])
  @@index([action])
}

// Authority escalation tracking (CSAM, terrorism)
model AuthorityEscalation {
  id              String    @id @default(uuid())
  ticketId        String    @unique
  reason          String
  contentType     String
  contentId       String
  escalatedAt     DateTime
  reportedTo      String    // IWF, NCMEC, Counter Terrorism Unit, etc.
  referenceNumber String?   // External reference from authority
  status          String    @default("reported") // reported, acknowledged, resolved
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
  
  @@index([reason])
  @@index([reportedTo])
}

// Transparency report data (aggregated quarterly)
model TransparencyReport {
  id                  String    @id @default(uuid())
  period              String    // Q1_2025, Q2_2025, etc.
  startDate           DateTime
  endDate             DateTime
  
  // Report counts
  totalReports        Int       @default(0)
  reportsByCategory   Json      // {illegal: 23, harmful: 156, ...}
  
  // Actions taken
  actionsTotal        Int       @default(0)
  actionsByType       Json      // {contentRemoved: 623, accountsSuspended: 89, ...}
  
  // Timing metrics
  avgResponseHours    Float     @default(0)
  under24Hours        Int       @default(0)
  under72Hours        Int       @default(0)
  over72Hours         Int       @default(0)
  
  // Appeals
  totalAppeals        Int       @default(0)
  appealsUpheld       Int       @default(0)
  appealsOverturned   Int       @default(0)
  
  // Published
  publishedAt         DateTime?
  publishedUrl        String?
  
  createdAt           DateTime  @default(now())
  updatedAt           DateTime  @updatedAt
  
  @@unique([period])
}

// User safety settings
model UserSafetySettings {
  id                      String    @id @default(uuid())
  userId                  String    @unique
  
  // Message controls
  allowMessagesFrom       String    @default("connections") // all, connections, none
  filterOffensiveContent  Boolean   @default(true)
  hideReadReceipts        Boolean   @default(false)
  
  // Profile visibility
  profileVisibility       String    @default("public") // public, connections, private
  hideOnlineStatus        Boolean   @default(false)
  hideLastSeen            Boolean   @default(false)
  
  // Blocking
  blockedUsers            String[]
  blockedKeywords         String[]
  
  // Safety alerts
  enableSafetyAlerts      Boolean   @default(true)
  
  user                    User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  createdAt               DateTime  @default(now())
  updatedAt               DateTime  @updatedAt
}

